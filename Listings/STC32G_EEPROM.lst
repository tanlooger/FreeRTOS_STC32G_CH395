C251 COMPILER V5.60.0,  STC32G_EEPROM                                                      24/03/23  00:55:30  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE STC32G_EEPROM
OBJECT MODULE PLACED IN .\Objects\STC32G_EEPROM.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\Driver\src\STC32G_EEPROM.c XSMALL FUNCTIONS(REENTRANT) OPTIMIZ
                    -E(4,SPEED) BROWSE INCDIR(.\Sources\User;.\Sources\User\include;.\Sources\FreeRTOS\include;.\Sources\FreeRTOS\portable\ST
                    -C32G12K128;.\Sources\Driver\inc;.\Sources\Task\inc;.\Sources\ch395) DEBUG PRINT(.\Listings\STC32G_EEPROM.lst) TABS(2) OB
                    -JECT(.\Objects\STC32G_EEPROM.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* å¦‚æœè¦åœ¨ç¨‹åºä¸­ä½¿ç”¨æ­¤ä»£ç ,è¯·åœ¨ç¨‹åºä¸­æ³¨æ˜ä½¿ç”¨äº†STCçš„èµ„æ–™åŠç¨‹åº            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          #include "STC32G_EEPROM.h"
   14          
   15          //========================================================================
   16          // å‡½æ•°: void ISP_Disable(void)
   17          // æè¿°: ç¦æ­¢è®¿é—®ISP/IAP.
   18          // å‚æ•°: non.
   19          // è¿”å›: non.
   20          // ç‰ˆæœ¬: V1.0, 2012-10-22
   21          //========================================================================
   22          void DisableEEPROM(void)
   23          {
   24   1        IAP_CONTR = 0;      //ç¦æ­¢IAPæ“ä½œ
   25   1        IAP_CMD   = 0;      //å»é™¤IAPå‘½ä»¤
   26   1        IAP_TRIG  = 0;      //é˜²æ­¢IAPå‘½ä»¤è¯¯è§¦å‘
   27   1        IAP_ADDRE = 0xff;   //å°†åœ°å€è®¾ç½®åˆ°é IAP åŒºåŸŸ
   28   1        IAP_ADDRH = 0xff;   //å°†åœ°å€è®¾ç½®åˆ°é IAP åŒºåŸŸ
   29   1        IAP_ADDRL = 0xff;
   30   1      }
   31          
   32          //========================================================================
   33          // å‡½æ•°: void EEPROM_Trig(void)
   34          // æè¿°: è§¦å‘EEPROMæ“ä½œ.
   35          // å‚æ•°: none.
   36          // è¿”å›: none.
   37          // ç‰ˆæœ¬: V1.0, 2014-6-30
   38          //========================================================================
   39          void EEPROM_Trig(void)
   40          {
   41   1        F0 = EA;    //ä¿å­˜å…¨å±€ä¸­æ–­
   42   1        EA = 0;     //ç¦æ­¢ä¸­æ–­, é¿å…è§¦å‘å‘½ä»¤æ— æ•ˆ
   43   1        IAP_TRIG = 0x5A;
   44   1        IAP_TRIG = 0xA5;                    //å…ˆé€5AHï¼Œå†é€A5Håˆ°IAPè§¦å‘å¯„å­˜å™¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦å¦‚æ­¤
   45   1                                            //é€å®ŒA5Håï¼ŒIAPå‘½ä»¤ç«‹å³è¢«è§¦å‘å¯åŠ¨
   46   1                                            //CPUç­‰å¾…IAPå®Œæˆåï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œç¨‹åºã€‚
   47   1        _nop_();   //ç”±äºSTC32Gæ˜¯å¤šçº§æµæ°´çº¿çš„æŒ‡ä»¤ç³»ç»Ÿï¼Œè§¦å‘å‘½ä»¤åå»ºè®®åŠ 4ä¸ªNOPï¼Œä¿è¯IAP
             -_DATAçš„æ•°æ®å®Œæˆå‡†å¤‡
   48   1        _nop_();
   49   1        _nop_();
   50   1        _nop_();
   51   1        EA = F0;    //æ¢å¤å…¨å±€ä¸­æ–­
   52   1      }
   53          
   54          //========================================================================
   55          // å‡½æ•°: void EEPROM_read_n(uint32_t EE_address,uint8_t *DataAddress,uint16_t number)
C251 COMPILER V5.60.0,  STC32G_EEPROM                                                      24/03/23  00:55:30  PAGE 2   

   56          // æè¿°: ä»æŒ‡å®šEEPROMé¦–åœ°å€è¯»å‡ºnä¸ªå­—èŠ‚æ”¾æŒ‡å®šçš„ç¼“å†².
   57          // å‚æ•°: EE_address:  è¯»å‡ºEEPROMçš„é¦–åœ°å€.
   58          //       DataAddress: è¯»å‡ºæ•°æ®æ”¾ç¼“å†²çš„é¦–åœ°å€.
   59          //       number:      è¯»å‡ºçš„å­—èŠ‚é•¿åº¦.
   60          // è¿”å›: non.
   61          // ç‰ˆæœ¬: V1.0, 2012-10-22
   62          //========================================================================
   63          void EEPROM_read_n(uint32_t EE_address,uint8_t *DataAddress,uint16_t number)
   64          {
   65   1        IAP_ENABLE();                           //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
   66   1        IAP_READ();                             //é€å­—èŠ‚è¯»å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é‡æ–°é€å‘
             -½ä»¤
   67   1        do
   68   1        {
   69   2          IAP_ADDRE = (uint8_t)(EE_address >> 16); //é€åœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
   70   2          IAP_ADDRH = (uint8_t)(EE_address >> 8);  //é€åœ°å€ä¸­å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
   71   2          IAP_ADDRL = (uint8_t)EE_address;         //é€åœ°å€ä½å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
   72   2          EEPROM_Trig();                      //è§¦å‘EEPROMæ“ä½œ
   73   2          *DataAddress = IAP_DATA;            //è¯»å‡ºçš„æ•°æ®é€å¾€
   74   2          EE_address++;
   75   2          DataAddress++;
   76   2        }while(--number);
   77   1      
   78   1        DisableEEPROM();
   79   1      }
   80          
   81          //========================================================================
   82          // å‡½æ•°: void EEPROM_SectorErase(uint32_t EE_address)
   83          // æè¿°: æŠŠæŒ‡å®šåœ°å€çš„EEPROMæ‰‡åŒºæ“¦é™¤.
   84          // å‚æ•°: EE_address:  è¦æ“¦é™¤çš„æ‰‡åŒºEEPROMçš„åœ°å€.
   85          // è¿”å›: non.
   86          // ç‰ˆæœ¬: V1.0, 2013-5-10
   87          //========================================================================
   88          void EEPROM_SectorErase(uint32_t EE_address)
   89          {
   90   1        IAP_ENABLE();                       //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
   91   1        IAP_ERASE();                        //å®è°ƒç”¨, é€æ‰‡åŒºæ“¦é™¤å‘½ä»¤ï¼Œå‘½ä»¤ä¸éœ€æ”¹å˜æ—¶ï¼Œä¸éœ€é
             -‡æ–°é€å‘½ä»¤
   92   1                                            //åªæœ‰æ‰‡åŒºæ“¦é™¤ï¼Œæ²¡æœ‰å­—èŠ‚æ“¦é™¤ï¼Œ512å­—èŠ‚/æ‰‡åŒºã€‚
   93   1                                            //æ‰‡åŒºä¸­ä»»æ„ä¸€ä¸ªå­—èŠ‚åœ°å€éƒ½æ˜¯æ‰‡åŒºåœ°å€ã€‚
   94   1        IAP_ADDRE = (uint8_t)(EE_address >> 16); //é€æ‰‡åŒºåœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é
             -€åœ°å€ï¼‰
   95   1        IAP_ADDRH = (uint8_t)(EE_address >> 8);  //é€æ‰‡åŒºåœ°å€ä¸­å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é
             -€åœ°å€ï¼‰
   96   1        IAP_ADDRL = (uint8_t)EE_address;         //é€æ‰‡åŒºåœ°å€ä½å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é
             -€åœ°å€ï¼‰
   97   1        EEPROM_Trig();                      //è§¦å‘EEPROMæ“ä½œ
   98   1        DisableEEPROM();                    //ç¦æ­¢EEPROMæ“ä½œ
   99   1      }
  100          
  101          //========================================================================
  102          // å‡½æ•°: void EEPROM_write_n(uint32_t EE_address,uint8_t *DataAddress,uint16_t number)
  103          // æè¿°: æŠŠç¼“å†²çš„nä¸ªå­—èŠ‚å†™å…¥æŒ‡å®šé¦–åœ°å€çš„EEPROM.
  104          // å‚æ•°: EE_address:  å†™å…¥EEPROMçš„é¦–åœ°å€.
  105          //       DataAddress: å†™å…¥æºæ•°æ®çš„ç¼“å†²çš„é¦–åœ°å€.
  106          //       number:      å†™å…¥çš„å­—èŠ‚é•¿åº¦.
  107          // è¿”å›: non.
  108          // ç‰ˆæœ¬: V1.0, 2012-10-22
  109          //========================================================================
  110          void EEPROM_write_n(uint32_t EE_address,uint8_t *DataAddress,uint16_t number)
  111          {
  112   1        IAP_ENABLE();                       //è®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œå…è®¸IAPæ“ä½œï¼Œé€ä¸€æ¬¡å°±å¤Ÿ
  113   1        IAP_WRITE();                        //å®è°ƒç”¨, é€å­—èŠ‚å†™å‘½ä»¤
C251 COMPILER V5.60.0,  STC32G_EEPROM                                                      24/03/23  00:55:30  PAGE 3   

  114   1        do
  115   1        {
  116   2          IAP_ADDRE = (uint8_t)(EE_address >> 16); //é€åœ°å€é«˜å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
  117   2          IAP_ADDRH = (uint8_t)(EE_address >> 8);  //é€åœ°å€ä¸­å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
  118   2          IAP_ADDRL = (uint8_t)EE_address;         //é€åœ°å€ä½å­—èŠ‚ï¼ˆåœ°å€éœ€è¦æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€åœ°
             -å€ï¼‰
  119   2          IAP_DATA  = *DataAddress;         //é€æ•°æ®åˆ°IAP_DATAï¼Œåªæœ‰æ•°æ®æ”¹å˜æ—¶æ‰éœ€é‡æ–°é€
  120   2          EEPROM_Trig();                    //è§¦å‘EEPROMæ“ä½œ
  121   2          EE_address++;                     //ä¸‹ä¸€ä¸ªåœ°å€
  122   2          DataAddress++;                    //ä¸‹ä¸€ä¸ªæ•°æ®
  123   2        }while(--number);                   //ç›´åˆ°ç»“æŸ
  124   1        DisableEEPROM();
  125   1      }
  126          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       236     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

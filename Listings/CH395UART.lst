C251 COMPILER V5.60.0,  CH395UART                                                          24/03/23  00:55:40  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE CH395UART
OBJECT MODULE PLACED IN .\Objects\CH395UART.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\ch395\CH395UART.C XSMALL FUNCTIONS(REENTRANT) OPTIMIZE(4,SPEED
                    -) BROWSE INCDIR(.\Sources\User;.\Sources\User\include;.\Sources\FreeRTOS\include;.\Sources\FreeRTOS\portable\STC32G12K12
                    -8;.\Sources\Driver\inc;.\Sources\Task\inc;.\Sources\ch395) DEBUG PRINT(.\Listings\CH395UART.lst) TABS(2) OBJECT(.\Object
                    -s\CH395UART.obj) 

stmt  level    source

    1          /********************************** (C) COPYRIGHT *******************************
    2          * File Name          : CH395UART.C
    3          * Author             : WCH
    4          * Version            : V1.1
    5          * Date               : 2014/8/1
    6          * Description        : CH395èŠ¯ç‰‡ UARTä¸²è¡Œè¿æ¥çš„ç¡¬ä»¶æŠ½è±¡å±‚ V1.0
    7          *                      
    8          *******************************************************************************/
    9          
   10          #include "FreeRTOS.h"
   11          #include "CH395INC.H"
   12          
   13          /* ç¡¬ä»¶ç›¸å…³å®å®šä¹‰ */
   14          /* æœ¬ä¾‹ä¸­çš„ç¡¬ä»¶è¿æ¥æ–¹å¼å¦‚ä¸‹(å®é™…åº”ç”¨ç”µè·¯å¯ä»¥å‚ç…§ä¿®æ”¹ä¸‹è¿°å®šä¹‰åŠå­ç¨‹åº) */
   15          /* å•ç‰‡æœºçš„å¼•è„š    CH395èŠ¯ç‰‡çš„å¼•è„š
   16                TXD                  RXD
   17                RXD                  TXD       */
   18          #define CH395_INT_WIRE             INT1                          /* å‡å®šCH395çš„INT#å¼•è„š,å¦‚æœæœªè¿
             -æ¥é‚£ä¹ˆä¹Ÿå¯ä»¥é€šè¿‡æŸ¥è¯¢ä¸²å£ä¸­æ–­çŠ¶æ€ç å®ç° */
   19          
   20          #define UART_INIT_BAUDRATE         9600                          /* é»˜è®¤é€šè®¯æ³¢ç‰¹ç‡9600bps,å»ºè®®é€
             -šè¿‡ç¡¬ä»¶å¼•è„šè®¾å®šç›´æ¥é€‰æ‹©æ›´é«˜çš„CH395çš„é»˜è®¤é€šè®¯æ³¢ç‰¹ç‡ */
   21          #define UART_WORK_BAUDRATE         57600                         /* æ­£å¼é€šè®¯æ³¢ç‰¹ç‡57600bps */
   22          
   23          
   24          /*******************************************************************************
   25          * Function Name  : mDelayuS
   26          * Description    : å»¶æ—¶æŒ‡å®šå¾®ç§’æ—¶é—´,æ ¹æ®å•ç‰‡æœºä¸»é¢‘è°ƒæ•´,ä¸ç²¾ç¡®
   27          * Input          : us---å»¶æ—¶æ—¶é—´å€¼
   28          * Output         : None
   29          * Return         : None
   30          *******************************************************************************/
   31          void mDelayuS(uint8_t us)
   32          {
   33   1          while(us --);                                                    /* MCS51@24MHz */
   34   1      }
   35          
   36          /*******************************************************************************
   37          * Function Name  : mDelaymS
   38          * Description    : å»¶æ—¶æŒ‡å®šæ¯«ç§’æ—¶é—´,æ ¹æ®å•ç‰‡æœºä¸»é¢‘è°ƒæ•´,ä¸ç²¾ç¡®
   39          * Input          : ms---å»¶æ—¶æ—¶é—´å€¼
   40          * Output         : None
   41          * Return         : None
   42          *******************************************************************************/
   43          void mDelaymS(uint8_t ms)
   44          {
   45   1          while(ms --) 
   46   1          {
   47   2              mDelayuS(250);
   48   2              mDelayuS(250);
   49   2              mDelayuS(250);
   50   2              mDelayuS(250);
   51   2          }
   52   1      }
   53          
   54          /*******************************************************************************
C251 COMPILER V5.60.0,  CH395UART                                                          24/03/23  00:55:40  PAGE 2   

   55          * Function Name  : CH395_PORT_INIT
   56          * Description    : ç¡¬ä»¶åˆå§‹åŒ–éƒ¨åˆ†
   57          * Input          : None
   58          * Output         : None
   59          * Return         : None
   60          void CH395_PORT_INIT(void)
   61          {
   62              // å¦‚æœå•ç‰‡æœºåªæœ‰ä¸€ä¸ªä¸²å£,é‚£ä¹ˆå¿…é¡»ç¦æ­¢é€šè¿‡ä¸²å£è¾“å‡ºç›‘æ§ä¿¡æ¯ 
   63              SCON = 0x50;
   64              PCON = 0x80;
   65          //  TL2 = RCAP2L = 0 - 18432000/32/UART_INIT_BAUDRATE;               // 18.432MHzæ™¶æŒ¯ 
   66              TL2 = RCAP2L = 0 - 24000000/32/UART_INIT_BAUDRATE;               // 24MHzæ™¶æŒ¯ 
   67          
   68              // å»ºè®®é€šè¿‡ç¡¬ä»¶å¼•è„šè®¾å®šç›´æ¥é€‰æ‹©æ›´é«˜çš„CH395çš„é»˜è®¤é€šè®¯æ³¢ç‰¹ç‡ 
   69              TH2 = RCAP2H = 0xFF;
   70              T2CON = 0x34;                                                    // å®šæ—¶å™¨2ç”¨äºä¸²å£çš„æ³¢ç‰¹ç
             -‡å‘ç”Ÿå™¨ 
   71              RI = 0;
   72          }
   73          *******************************************************************************/
   74          
   75          /*******************************************************************************
   76          * Function Name  : Set_MCU_BaudRate
   77          * Description    : è®¾ç½®å•ç‰‡æœºæ³¢ç‰¹ç‡
   78          *                  å°†å•ç‰‡æœºåˆ‡æ¢åˆ°æ­£å¼é€šè®¯æ³¢ç‰¹ç‡ 
   79          * Input          : None
   80          * Output         : None
   81          * Return         : None
   82          void SetMCUBaudRate(void)                                
   83          {
   84          //  TL2 = RCAP2L = 0 - 18432000/32/UART_WORK_BAUDRATE;               // 18.432MHzæ™¶æŒ¯ 
   85              TL2 = RCAP2L = 0 - 24000000/32/UART_WORK_BAUDRATE;               // 24MHzæ™¶æŒ¯ 
   86              RI = 0;
   87          }
   88          *******************************************************************************/
   89          
   90          
   91          /********************************************************************************
   92          * Function Name  : xWriteCH395Cmd
   93          * Description    : å‘CH395å†™å‘½ä»¤
   94          * Input          : cmd 8ä½çš„å‘½ä»¤ç 
   95          * Output         : None
   96          * Return         : None
   97          *******************************************************************************/
   98          void xWriteCH395Cmd(uint8_t cmd)                                      
   99          {
  100   1          TI = 0;
  101   1          SBUF = SER_SYNC_CODE1;                                           // å¯åŠ¨æ“ä½œçš„ç¬¬1ä¸ªä¸²å£åŒæ­
             -¥ç 
  102   1          while(TI == 0);
  103   1          TI = 0;
  104   1          SBUF = SER_SYNC_CODE2;                                           // å¯åŠ¨æ“ä½œçš„ç¬¬2ä¸ªä¸²å£åŒæ­
             -¥ç  
  105   1          while(TI == 0);
  106   1          TI = 0;
  107   1          SBUF = cmd;                                                      // ä¸²å£è¾“å‡º 
  108   1          while(TI == 0);
  109   1          RI = 0;                                                                 
  110   1      }
  111          
  112          /********************************************************************************
  113          * Function Name  : xWriteCH395Data
  114          * Description    : å‘CH395å†™æ•°æ®
  115          * Input          : mdata 8ä½æ•°æ®
  116          * Output         : None
  117          * Return         : None
C251 COMPILER V5.60.0,  CH395UART                                                          24/03/23  00:55:40  PAGE 3   

  118          *******************************************************************************/
  119          void  xWriteCH395Data(uint8_t mdata)
  120          {                                                                    /* å‘CH395å†™æ•°æ® */
  121   1          TI = 0;
  122   1          SBUF = mdata;                                                    /* ä¸²å£è¾“å‡º */
  123   1          while(TI == 0);
  124   1      }
  125          
  126          /********************************************************************************
  127          * Function Name  : xReadCH395Data
  128          * Description    : ä»CH395è¯»æ•°æ®
  129          * Input          : None
  130          * Output         : None
  131          * Return         : 8ä½æ•°æ®
  132          *******************************************************************************/
  133          uint8_t  xReadCH395Data(void)                                          /* ä»CH395è¯»æ•°æ® */
  134          {
  135   1          UINT32 i;
  136   1          
  137   1          for(i = 0; i < 500000; i ++) 
  138   1          {  
  139   2              /* è®¡æ•°é˜²æ­¢è¶…æ—¶ */
  140   2              if(RI) 
  141   2              {  
  142   3                  /* ä¸²å£æ¥æ”¶åˆ° */
  143   3                  RI = 0;
  144   3                  return(SBUF);                                            /* ä¸²å£è¾“å…¥ */
  145   3              }
  146   2          }
  147   1          return(0);                                                       /* ä¸åº”è¯¥å‘ç”Ÿçš„æƒ…å†µ */
  148   1      }
  149          
  150          #define xEndCH395Cmd()     {}                                        /* å‘½ä»¤ç»“æŸï¼Œä»…åœ¨SPIæ¨¡å¼ä¸‹
             -æœ‰æ•ˆ */
  151          
  152          /**************************** endfile *************************************/


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       126     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

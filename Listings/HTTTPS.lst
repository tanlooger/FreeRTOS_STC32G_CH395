C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE HTTTPS
OBJECT MODULE PLACED IN .\Objects\HTTTPS.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\ch395\HTTTPS.C XSMALL FUNCTIONS(REENTRANT) OPTIMIZE(4,SPEED) B
                    -ROWSE INCDIR(.\Sources\User;.\Sources\User\include;.\Sources\FreeRTOS\include;.\Sources\FreeRTOS\portable\STC32G12K128;.
                    -\Sources\Driver\inc;.\Sources\Task\inc;.\Sources\ch395) DEBUG PRINT(.\Listings\HTTTPS.lst) TABS(2) OBJECT(.\Objects\HTTT
                    -PS.obj) 

stmt  level    source

    1          /********************************** (C) COPYRIGHT *********************************
    2          * File Name          : HTTPS.C
    3          * Author             : WCH
    4          * Version            : V1.1
    5          * Date               : 2014/8/1
    6          * Description        : webÊé•Âè£ÂáΩÊï∞
    7          *             
    8          **********************************************************************************/
    9          #include "CH395INC.H"
   10          
   11          #include <stdio.h>
   12          #include <string.h>
   13          #include <stdlib.h>  
   14          #include <assert.h>  
   15          //#include "..\SRC\SYSFREQ.H"
   16          #include "https.h"
   17          #include "ch395.h" 
   18          #include "ch395cmd.h" 
   19          
   20          char* strstr(const char* str1, const char* str2)
   21          {
   22   1        const char* s1 = str1;
   23   1        const char* s2 = str2;
   24   1        const char* p = str1;
   25   1          assert(str1 && str2);
   26   1      
   27   1        while (*p!='\0')
   28   1        {
   29   2          s1 =p ;
   30   2          s2 = str2;
   31   2          while (*s1 != '\0' && *s2 != '\0' && *s1 == *s2)
   32   2          {
   33   3            s1++;
   34   3            s2++;
   35   3          }
   36   2          if (*s2 == '\0')
   37   2          {
   38   3            return (char*)p;
   39   3          }
   40   2          p++;
   41   2        }
   42   1        return NULL;
   43   1      } 
   44           
   45          
   46          
   47          
   48          unsigned int is_delim(char c, char *delim)
   49          {
   50   1          while(*delim != '\0')
   51   1          {
   52   2              if(c == *delim)
   53   2                  return 1;
   54   2              delim++;
   55   2          }
   56   1          return 0;
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 2   

   57   1      }
   58          char *strtok(char *srcString, char *delim)
   59          {
   60   1          static char *backup_string; // start of the next search
   61   1          char *ret = srcString;
   62   1      
   63   1          if(!srcString)
   64   1          {
   65   2              srcString = backup_string;
   66   2          }
   67   1          if(!srcString)
   68   1          {
   69   2              // user is bad user
   70   2              return NULL;
   71   2          }
   72   1          // handle beginning of the string containing delims
   73   1          while(1)
   74   1          {
   75   2              if(is_delim(*srcString, delim))
   76   2              {
   77   3                  srcString++;
   78   3                  continue;
   79   3              }
   80   2              if(*srcString == '\0')
   81   2              {
   82   3                  // we've reached the end of the string
   83   3                  return NULL; 
   84   3              }
   85   2              break;
   86   2          }
   87   1          
   88   1          
   89   1          while(1)
   90   1          {
   91   2              if(*srcString == '\0')
   92   2              {
   93   3                  //end of the input string and next exec will return NULL
   94   3                  backup_string = srcString;
   95   3                  return ret;
   96   3              }
   97   2              if(is_delim(*srcString, delim))
   98   2              {
   99   3                  *srcString = '\0';
  100   3                  backup_string = srcString + 1;
  101   3                  return ret;
  102   3              }
  103   2              srcString++;
  104   2          }
  105   1      }
  106          
  107          
  108          
  109          //‰∏¥Êó∂ÂèòÈáèÂèäÂ§ñÈÉ®ÂèòÈáèÂèòÈáèÂ£∞Êòé
  110          /*
  111           extern char homepage_default[],test[];
  112           //extern UINT8  HtmlBuffer[2716];
  113          // extern UINT8  HtmlBuffer[100];
  114          */
  115            st_http_request *http_request;  
  116           char tempURI[MAX_URI_SIZE]; 
  117            char   *ptr1,*name,*ptemp;
  118           UINT8  flag, ipp[4],i,lastip[4],ADC[3];
  119           UINT16 port,lastport,len,Socket0SourPort;
  120          
  121          UINT8 RecvBuffer[4096], CH395IPAddr[4],CH395GWIPAddr[4],CH395IPMask[4],CH395MACAddr[6];
  122          
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 3   

  123          /*********************WEBÂìçÂ∫îÊä•Êñá***************************************/
  124           UINT8 httpweb[200] ; 
  125          /********************HTMLÊñáÊú¨‰ø°ÊÅØ***************************************/
  126          /*‰∫¶ÂèØÁõ¥Êé•Áî®ÔºåHTMLÊ†ºÂºèÁöÑÊ∫êÊñá‰ª∂*/
  127          
  128           UINT8 HtmlBuffer[2716] = {
  129            0x3C, 0x21, 0x44, 0x4F, 0x43, 0x54, 0x59, 0x50, 0x45, 0x20, 0x68, 0x74, 0x6D, 0x6C, 0x3E, 0x0D, 
  130            0x0A, 0x3C, 0x68, 0x74, 0x6D, 0x6C, 0x3E, 0x0D, 0x0A, 0x3C, 0x68, 0x65, 0x61, 0x64, 0x3E, 0x0D, 
  131            0x0A, 0x3C, 0x62, 0x6F, 0x64, 0x79, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x2F, 0x68, 0x65, 0x61, 
  132            0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x61, 0x62, 0x6C, 0x65, 0x20, 0x77, 0x69, 0x64, 0x74, 0x68, 
  133            0x3D, 0x22, 0x31, 0x32, 0x30, 0x30, 0x22, 0x20, 0x62, 0x6F, 0x72, 0x64, 0x65, 0x72, 0x3D, 0x22, 
  134            0x30, 0x22, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x64, 0x20, 0x63, 
  135            0x6F, 0x6C, 0x73, 0x70, 0x61, 0x6E, 0x3D, 0x22, 0x32, 0x22, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 
  136            0x3D, 0x22, 0x62, 0x61, 0x63, 0x6B, 0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x2D, 0x63, 0x6F, 0x6C, 
  137            0x6F, 0x72, 0x3A, 0x23, 0x39, 0x39, 0x62, 0x62, 0x62, 0x62, 0x3B, 0x22, 0x3E, 0x0D, 0x0A, 0x3C, 
  138            0x68, 0x31, 0x3E, 0x20, 0x3C, 0x63, 0x65, 0x6E, 0x74, 0x65, 0x72, 0x3E, 0xBB, 0xF9, 0xD3, 0xDA, 
  139            0x43, 0x48, 0x33, 0x39, 0x35, 0x57, 0x45, 0x42, 0xB7, 0xFE, 0xCE, 0xF1, 0xC6, 0xF7, 0xD1, 0xDD, 
  140            0xCA, 0xBE, 0xD2, 0xB3, 0xC3, 0xE6, 0x20, 0x20, 0x3C, 0x2F, 0x68, 0x31, 0x3E, 0x0D, 0x0A, 0x3C, 
  141            0x2F, 0x74, 0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 
  142            0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x64, 0x20, 0x63, 0x6F, 0x6C, 0x73, 0x70, 0x61, 0x6E, 
  143            0x3D, 0x22, 0x32, 0x22, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x62, 0x61, 0x63, 0x6B, 
  144            0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x2D, 0x63, 0x6F, 0x6C, 0x6F, 0x72, 0x3A, 0x67, 0x72, 0x61, 
  145            0x79, 0x3B, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3A, 0x35, 0x30, 0x70, 0x78, 0x3B, 0x22, 0x3E, 
  146            0x0D, 0x0A, 0x3C, 0x68, 0x31, 0x3E, 0x3C, 0x6C, 0x65, 0x66, 0x74, 0x3E, 0x3C, 0x73, 0x6D, 0x61, 
  147            0x6C, 0x6C, 0x3E, 0xCB, 0xB5, 0xC3, 0xF7, 0x3A, 0x31, 0xA1, 0xA2, 0xB1, 0xBE, 0xD2, 0xB3, 0xC3, 
  148            0xE6, 0xD3, 0xC3, 0xD3, 0xDA, 0xD1, 0xDD, 0xCA, 0xBE, 0xBB, 0xF9, 0xD3, 0xDA, 0x43, 0x48, 0x33, 
  149            0x39, 0x35, 0x57, 0x45, 0x42, 0xB7, 0xFE, 0xCE, 0xF1, 0xC6, 0xF7, 0xB9, 0xA4, 0xD7, 0xF7, 0xD4, 
  150            0xAD, 0xC0, 0xED, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 
  151            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x32, 0xA1, 0xA2, 0xCD, 
  152            0xA8, 0xB9, 0xFD, 0xD2, 0xB3, 0xC3, 0xE6, 0xC9, 0xCF, 0xB5, 0xC4, 0xBF, 0xD8, 0xD6, 0xC6, 0xB0, 
  153            0xB4, 0xC5, 0xA5, 0xA3, 0xAC, 0xC4, 0xFA, 0xBF, 0xC9, 0xD2, 0xD4, 0xCA, 0xB5, 0xCA, 0xB1, 0xD4, 
  154            0xB6, 0xB3, 0xCC, 0x4C, 0x45, 0x44, 0xBF, 0xD8, 0xD6, 0xC6, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x26, 
  155            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 
  156            0x73, 0x70, 0x3B, 0x33, 0xA1, 0xA2, 0xCD, 0xA8, 0xB9, 0xFD, 0xB9, 0xDB, 0xB2, 0xEC, 0xB4, 0xB0, 
  157            0xBF, 0xDA, 0xBD, 0xF8, 0xD0, 0xD0, 0xD4, 0xB6, 0xB3, 0xCC, 0xCA, 0xFD, 0xBE, 0xDD, 0xBC, 0xE0, 
  158            0xB2, 0xE2, 0x3C, 0x2F, 0x73, 0x6D, 0x61, 0x6C, 0x6C, 0x3E, 0x3C, 0x2F, 0x68, 0x31, 0x3E, 0x0D, 
  159            0x0A, 0x3C, 0x2F, 0x74, 0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 
  160            0x74, 0x72, 0x20, 0x76, 0x61, 0x6C, 0x69, 0x67, 0x6E, 0x3D, 0x22, 0x74, 0x6F, 0x70, 0x22, 0x3E, 
  161            0x0D, 0x0A, 0x3C, 0x74, 0x64, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x62, 0x61, 0x63, 
  162            0x6B, 0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x2D, 0x63, 0x6F, 0x6C, 0x6F, 0x72, 0x3A, 0x23, 0x66, 
  163            0x66, 0x66, 0x66, 0x39, 0x39, 0x3B, 0x77, 0x69, 0x64, 0x74, 0x68, 0x3A, 0x36, 0x30, 0x30, 0x70, 
  164            0x78, 0x3B, 0x74, 0x65, 0x78, 0x74, 0x2D, 0x61, 0x6C, 0x69, 0x67, 0x6E, 0x3A, 0x74, 0x6F, 0x70, 
  165            0x3B, 0x22, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 
  166            0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x3C, 0x66, 0x6F, 
  167            0x6E, 0x74, 0x20, 0x20, 0x73, 0x69, 0x7A, 0x65, 0x20, 0x3D, 0x20, 0x31, 0x33, 0x20, 0x3E, 0x26, 
  168            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 
  169            0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  170            0x3B, 0x20, 0x20, 0xBF, 0xD8, 0xD6, 0xC6, 0xB4, 0xB0, 0xBF, 0xDA, 0x3C, 0x2F, 0x66, 0x6F, 0x6E, 
  171            0x74, 0x3E, 0x09, 0x3C, 0x2F, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 
  172            0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 
  173            0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x66, 
  174            0x6F, 0x72, 0x6D, 0x20, 0x20, 0x61, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x3D, 0x22, 0x4C, 0x45, 0x44, 
  175            0x43, 0x4F, 0x4E, 0x54, 0x52, 0x4F, 0x4C, 0x2E, 0x43, 0x47, 0x49, 0x22, 0x3E, 0x0D, 0x0A, 0x3C, 
  176            0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x3C, 0x66, 0x6F, 0x6E, 0x74, 0x20, 0x20, 0x73, 0x69, 
  177            0x7A, 0x65, 0x20, 0x3D, 0x20, 0x35, 0x20, 0x3E, 0x0D, 0x0A, 0x09, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  178            0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x0D, 0x0A, 0x09, 
  179            0x4C, 0x45, 0x44, 0x31, 0x20, 0xD7, 0xB4, 0xCC, 0xAC, 0xA3, 0xBA, 0xC3, 0xF0, 0x20, 0x26, 0x6E, 
  180            0x62, 0x73, 0x70, 0x20, 0x20, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x76, 0x61, 0x6C, 0x75, 
  181            0x65, 0x3D, 0x22, 0x31, 0x22, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x22, 0x6C, 0x65, 0x64, 0x31, 
  182            0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x63, 0x68, 0x65, 0x63, 0x6B, 0x62, 0x6F, 0x78, 
  183            0x22, 0x3E, 0xB4, 0xF2, 0xBF, 0xAA, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 
  184            0x70, 0x20, 0x09, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 
  185            0x22, 0x32, 0x22, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x22, 0x6C, 0x65, 0x64, 0x31, 0x22, 0x20, 
  186            0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x63, 0x68, 0x65, 0x63, 0x6B, 0x62, 0x6F, 0x78, 0x22, 0x3E, 
  187            0xB9, 0xD8, 0xB1, 0xD5, 0x20, 0x0D, 0x0A, 0x20, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 
  188            0x3E, 0x0D, 0x0A, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 4   

  189            0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x4C, 0x45, 0x44, 0x32, 0x20, 0xD7, 0xB4, 0xCC, 
  190            0xAC, 0xA3, 0xBA, 0xC3, 0xF0, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x3C, 0x69, 0x6E, 
  191            0x70, 0x75, 0x74, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x33, 0x22, 0x20, 0x6E, 0x61, 
  192            0x6D, 0x65, 0x3D, 0x22, 0x6C, 0x65, 0x64, 0x32, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 
  193            0x63, 0x68, 0x65, 0x63, 0x6B, 0x62, 0x6F, 0x78, 0x22, 0x3E, 0xB4, 0xF2, 0xBF, 0xAA, 0x20, 0x20, 
  194            0x20, 0x20, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x09, 0x3C, 0x69, 0x6E, 0x70, 0x75, 
  195            0x74, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x34, 0x22, 0x20, 0x6E, 0x61, 0x6D, 0x65, 
  196            0x3D, 0x22, 0x6C, 0x65, 0x64, 0x32, 0x22, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x63, 0x68, 
  197            0x65, 0x63, 0x6B, 0x62, 0x6F, 0x78, 0x22, 0x3E, 0xB9, 0xD8, 0xB1, 0xD5, 0x20, 0x0D, 0x0A, 0x0D, 
  198            0x0A, 0x3C, 0x2F, 0x66, 0x6F, 0x6E, 0x74, 0x3E, 0x09, 0x3C, 0x2F, 0x73, 0x74, 0x72, 0x6F, 0x6E, 
  199            0x67, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 
  200            0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 
  201            0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 
  202            0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 
  203            0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 
  204            0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  205            0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 
  206            0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 
  207            0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  208            0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x0D, 0x0A, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 
  209            0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x53, 0x65, 0x6E, 0x64, 0x22, 0x20, 0x74, 0x79, 
  210            0x70, 0x65, 0x3D, 0x22, 0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 0x22, 0x3E, 0x20, 0x3C, 0x2F, 0x66, 
  211            0x6F, 0x72, 0x6D, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x68, 0x33, 0x3E, 
  212            0x3C, 0x66, 0x6F, 0x6E, 0x74, 0x20, 0x73, 0x69, 0x7A, 0x65, 0x3D, 0x22, 0x2D, 0x31, 0x22, 0x3E, 
  213            0x3C, 0x73, 0x70, 0x61, 0x6E, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x63, 0x6F, 0x6C, 
  214            0x6F, 0x72, 0x3A, 0x20, 0x62, 0x6C, 0x61, 0x63, 0x6B, 0x3B, 0x22, 0x3E, 0x3C, 0x2F, 0x73, 0x70, 
  215            0x61, 0x6E, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x66, 0x6F, 0x6E, 0x74, 0x3E, 0x3C, 0x2F, 0x68, 0x33, 
  216            0x3E, 0x3C, 0x68, 0x33, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x66, 0x6F, 0x6E, 0x74, 
  217            0x2D, 0x77, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3A, 0x20, 0x6E, 0x6F, 0x72, 0x6D, 0x61, 0x6C, 0x3B, 
  218            0x20, 0x66, 0x6F, 0x6E, 0x74, 0x2D, 0x66, 0x61, 0x6D, 0x69, 0x6C, 0x79, 0x3A, 0x20, 0x56, 0x65, 
  219            0x72, 0x64, 0x61, 0x6E, 0x61, 0x3B, 0x22, 0x3E, 0x3C, 0x66, 0x6F, 0x6E, 0x74, 0x20, 0x73, 0x69, 
  220            0x7A, 0x65, 0x3D, 0x22, 0x2D, 0x31, 0x22, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 
  221            0x66, 0x6F, 0x6E, 0x74, 0x3E, 0x3C, 0x2F, 0x68, 0x33, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 
  222            0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 
  223            0x0D, 0x0A, 0x3C, 0x66, 0x6F, 0x72, 0x6D, 0x20, 0x61, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x3D, 0x22, 
  224            0x43, 0x48, 0x33, 0x39, 0x35, 0x53, 0x45, 0x54, 0x49, 0x4E, 0x47, 0x2E, 0x43, 0x47, 0x49, 0x22, 
  225            0x3E, 0x0D, 0x0A, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  226            0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 
  227            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 
  228            0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 
  229            0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 
  230            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x49, 0x50, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x26, 0x6E, 0x62, 0x73, 
  231            0x70, 0x20, 0x20, 0x3A, 0x3C, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 
  232            0x49, 0x50, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x74, 0x65, 0x78, 0x74, 0x20, 0x76, 0x61, 0x6C, 
  233            0x75, 0x65, 0x3D, 0x20, 0x31, 0x39, 0x32, 0x2E, 0x31, 0x36, 0x38, 0x2E, 0x31, 0x31, 0x31, 0x2E, 
  234            0x36, 0x34, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x26, 0x6E, 
  235            0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 
  236            0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x20, 0x63, 0x6F, 
  237            0x6C, 0x6F, 0x72, 0x3A, 0x23, 0x62, 0x6C, 0x61, 0x63, 0x6B, 0x22, 0x20, 0x3E, 0x3C, 0x62, 0x72, 
  238            0x3E, 0x0D, 0x0A, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  239            0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 
  240            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 
  241            0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 
  242            0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 
  243            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x50, 0x4F, 0x52, 0x54, 0x20, 0x3A, 0x3C, 0x69, 0x6E, 0x70, 0x75, 
  244            0x74, 0x20, 0x6E, 0x61, 0x6D, 0x65, 0x3D, 0x50, 0x4F, 0x52, 0x54, 0x20, 0x74, 0x79, 0x70, 0x65, 
  245            0x3D, 0x74, 0x65, 0x78, 0x74, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x20, 0x38, 0x30, 0x20, 
  246            0x20, 0x20, 0x20, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  247            0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 
  248            0x70, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x20, 
  249            0x63, 0x6F, 0x6C, 0x6F, 0x72, 0x3A, 0x23, 0x62, 0x6C, 0x61, 0x63, 0x6B, 0x22, 0x20, 0x3E, 0x3C, 
  250            0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 
  251            0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 
  252            0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 
  253            0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 
  254            0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 5   

  255            0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 0x6E, 0x62, 0x73, 0x70, 
  256            0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x3B, 0x26, 
  257            0x6E, 0x62, 0x73, 0x70, 0x3B, 0x20, 0x26, 0x6E, 0x62, 0x73, 0x70, 0x20, 0x20, 0x3C, 0x69, 0x6E, 
  258            0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 
  259            0x22, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x43, 0x48, 0x41, 0x4E, 0x47, 0x45, 0x22, 
  260            0x3E, 0x3C, 0x2F, 0x66, 0x6F, 0x72, 0x6D, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x73, 0x74, 0x72, 0x6F, 
  261            0x6E, 0x67, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x2F, 0x74, 0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 
  262            0x64, 0x20, 0x73, 0x74, 0x79, 0x6C, 0x65, 0x3D, 0x22, 0x62, 0x61, 0x63, 0x6B, 0x67, 0x72, 0x6F, 
  263            0x75, 0x6E, 0x64, 0x2D, 0x63, 0x6F, 0x6C, 0x6F, 0x72, 0x3A, 0x73, 0x69, 0x6C, 0x76, 0x65, 0x72, 
  264            0x3B, 0x68, 0x65, 0x69, 0x67, 0x68, 0x74, 0x3A, 0x36, 0x30, 0x30, 0x70, 0x78, 0x3B, 0x77, 0x69, 
  265            0x64, 0x74, 0x68, 0x3A, 0x36, 0x30, 0x30, 0x70, 0x78, 0x3B, 0x74, 0x65, 0x78, 0x74, 0x2D, 0x61, 
  266            0x6C, 0x69, 0x67, 0x6E, 0x3A, 0x74, 0x6F, 0x70, 0x3B, 0x22, 0x3E, 0x0D, 0x0A, 0x3C, 0x63, 0x65, 
  267            0x6E, 0x74, 0x65, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 
  268            0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x3C, 0x66, 0x6F, 
  269            0x6E, 0x74, 0x20, 0x20, 0x73, 0x69, 0x7A, 0x65, 0x20, 0x3D, 0x20, 0x31, 0x33, 0x20, 0x3E, 0xBC, 
  270            0xE0, 0xB2, 0xE2, 0xB4, 0xB0, 0xBF, 0xDA, 0x3C, 0x2F, 0x66, 0x6F, 0x6E, 0x74, 0x3E, 0x09, 0x3C, 
  271            0x2F, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x0D, 0x0A, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 
  272            0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 
  273            0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 
  274            0x3C, 0x73, 0x74, 0x72, 0x6F, 0x6E, 0x67, 0x3E, 0x3C, 0x66, 0x6F, 0x6E, 0x74, 0x20, 0x20, 0x73, 
  275            0x69, 0x7A, 0x65, 0x20, 0x3D, 0x20, 0x36, 0x20, 0x3E, 0x0D, 0x0A, 0x20, 0x3C, 0x62, 0x72, 0x3E, 
  276            0x0D, 0x0A, 0x20, 0x3C, 0x66, 0x6F, 0x72, 0x6D, 0x20, 0x61, 0x63, 0x74, 0x69, 0x6F, 0x6E, 0x3D, 
  277            0x22, 0x6D, 0x6F, 0x6E, 0x69, 0x74, 0x6F, 0x72, 0x2E, 0x43, 0x47, 0x49, 0x22, 0x3E, 0x0D, 0x0A, 
  278            0x20, 0xCE, 0xC2, 0xB6, 0xC8, 0xA3, 0xBA, 0x32, 0x35, 0x20, 0x20, 0xA1, 0xE3, 0x0D, 0x0A, 0x20, 
  279            0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x26, 0x6E, 
  280            0x62, 0x73, 0x70, 0x3B, 0xB5, 0xE7, 0xC1, 0xF7, 0xA3, 0xBA, 0x35, 0x30, 0x20, 0x20, 0x4D, 0x41, 
  281            0x0D, 0x0A, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 
  282            0x20, 0xB5, 0xE7, 0xD1, 0xB9, 0xA3, 0xBA, 0x31, 0x32, 0x20, 0x20, 0x56, 0x0D, 0x0A, 0x20, 0x3C, 
  283            0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x3C, 0x62, 0x72, 0x3E, 0x0D, 0x0A, 0x20, 0x3C, 0x69, 0x6E, 
  284            0x70, 0x75, 0x74, 0x20, 0x74, 0x79, 0x70, 0x65, 0x3D, 0x22, 0x73, 0x75, 0x62, 0x6D, 0x69, 0x74, 
  285            0x22, 0x20, 0x76, 0x61, 0x6C, 0x75, 0x65, 0x3D, 0x22, 0x77, 0x61, 0x74, 0x63, 0x68, 0x22, 0x3E, 
  286            0x0D, 0x0A, 0x3C, 0x2F, 0x66, 0x6F, 0x6E, 0x74, 0x3E, 0x09, 0x3C, 0x2F, 0x73, 0x74, 0x72, 0x6F, 
  287            0x6E, 0x67, 0x3E, 0x09, 0x0D, 0x0A, 0x3C, 0x2F, 0x74, 0x64, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 
  288            0x2F, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 0x3C, 0x74, 0x64, 0x20, 
  289            0x63, 0x6F, 0x6C, 0x73, 0x70, 0x61, 0x6E, 0x3D, 0x22, 0x32, 0x22, 0x20, 0x73, 0x74, 0x79, 0x6C, 
  290            0x65, 0x3D, 0x22, 0x62, 0x61, 0x63, 0x6B, 0x67, 0x72, 0x6F, 0x75, 0x6E, 0x64, 0x2D, 0x63, 0x6F, 
  291            0x6C, 0x6F, 0x72, 0x3A, 0x23, 0x39, 0x39, 0x62, 0x62, 0x62, 0x62, 0x3B, 0x74, 0x65, 0x78, 0x74, 
  292            0x2D, 0x61, 0x6C, 0x69, 0x67, 0x6E, 0x3A, 0x63, 0x65, 0x6E, 0x74, 0x65, 0x72, 0x3B, 0x22, 0x3E, 
  293            0x0D, 0x0A, 0x43, 0x6F, 0x70, 0x79, 0x72, 0x69, 0x67, 0x68, 0x74, 0x20, 0x3C, 0x41, 0x20, 0x68, 
  294            0x72, 0x65, 0x66, 0x20, 0x3D, 0x20, 0x22, 0x77, 0x77, 0x77, 0x2E, 0x77, 0x63, 0x68, 0x2E, 0x63, 
  295            0x6E, 0x22, 0x3E, 0x20, 0x77, 0x77, 0x77, 0x2E, 0x77, 0x63, 0x68, 0x2E, 0x63, 0x6E, 0x3C, 0x2F, 
  296            0x41, 0x3E, 0x3C, 0x2F, 0x74, 0x64, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x74, 0x72, 0x3E, 0x0D, 0x0A, 
  297            0x3C, 0x2F, 0x74, 0x61, 0x62, 0x6C, 0x65, 0x3E, 0x0D, 0x0A, 0x0D, 0x0A, 0x3C, 0x2F, 0x62, 0x6F, 
  298            0x64, 0x79, 0x3E, 0x0D, 0x0A, 0x3C, 0x2F, 0x68, 0x74, 0x6D, 0x6C, 0x3E
  299            };
  300            
  301          
  302          /*********************************************************************************
  303          * Function Name  : MakeHttpResponse
  304          * Description    : ÁîüÊàêÂìçÂ∫îÊä•Êñá
  305          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíàÔºåuriÁ±ªÂûã
  306          * Output         : None
  307          * Return         : None
  308          *********************************************************************************/
  309          void MakeHttpResponse(unsigned char * buf,char type)
  310          {
  311   1        char * head=0;
  312   1        char tmp[10];
  313   1        UINT16 len;      
  314   1        if   (type == PTYPE_HTML)        head = RES_HTMLHEAD_OK;
  315   1        else if (type == PTYPE_GIF)      head = RES_GIFHEAD_OK;
  316   1        else if (type == PTYPE_TEXT)     head = RES_TEXTHEAD_OK;
  317   1        else if (type == PTYPE_JPEG)     head = RES_JPEGHEAD_OK;
  318   1        else if (type == PTYPE_FLASH)    head = RES_FLASHHEAD_OK;
  319   1        else if (type == PTYPE_MPEG)     head = RES_MPEGHEAD_OK;
  320   1        else if (type == PTYPE_PDF)      head = RES_PDFHEAD_OK;
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 6   

  321   1        else if (type == PTYPE_CGI)      head = RETURN_CGI_PAGE;
  322   1        len = sizeof(HtmlBuffer);                      
  323   1        sprintf(tmp,"%ld", len);  
  324   1        strcpy((char*)buf, head);
  325   1        strcat((char*)buf, tmp);
  326   1        strcat((char*)buf, "\r\n\r\n");
  327   1      }
  328          
  329           /*********************************************************************************
  330          * Function Name  : ParseUriType
  331          * Description    : Ëß£ÊûêURIÁ±ªÂûã
  332          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíàÔºåÁ±ªÂûãËøîÂõûÊåáÈíà
  333          * Output         : None
  334          * Return         : None
  335          *********************************************************************************/
  336          void ParseUriType(UINT8 * type,char * buf ) 
  337          {
  338   1        if    (strstr(buf, ".htm"))                             *type = PTYPE_HTML;
  339   1        else if (strstr(buf, ".gif"))                           *type = PTYPE_GIF;
  340   1        else if (strstr(buf, ".text") || strstr(buf,".txt"))    *type = PTYPE_TEXT;
  341   1        else if (strstr(buf, ".jpeg") || strstr(buf,".jpg"))    *type = PTYPE_JPEG;
  342   1        else if (strstr(buf, ".swf"))                           *type = PTYPE_FLASH;
  343   1        else if (strstr(buf, ".mpeg") || strstr(buf,".mpg"))    *type = PTYPE_MPEG;
  344   1        else if (strstr(buf, ".pdf"))                           *type = PTYPE_PDF;
  345   1        else if (strstr(buf, ".cgi") || strstr(buf,".CGI"))     *type = PTYPE_CGI;
  346   1        else if (strstr(buf, ".js") || strstr(buf,".JS"))       *type = PTYPE_TEXT;  
  347   1        else if (strstr(buf, ".xml") || strstr(buf,".XML"))     *type = PTYPE_HTML;    
  348   1        else                                                    *type = PTYPE_ERR;
  349   1      }
  350          
  351           /*********************************************************************************
  352          * Function Name  : ParseHttpRequest
  353          * Description    : Ëß£ÊûêHTTPËØ∑Ê±Ç
  354          * Input          : URIËØ∑Ê±ÇÊåáÈíàÔºåÁºìÂÜ≤Âå∫ÊåáÈíà
  355          * Output         : None
  356          * Return         : None
  357          *********************************************************************************/
  358          void ParseHttpRequest(st_http_request * request,UINT8 * buf)
  359          {
  360   1        char * nexttok;
  361   1        nexttok = strtok((char*)buf," ");
  362   1        if(!nexttok)
  363   1        {
  364   2          request->METHOD = METHOD_ERR;
  365   2          return;
  366   2        }
  367   1        if   (!strcmp(nexttok, "GET") || !strcmp(nexttok,"get"))
  368   1        {
  369   2          request->METHOD = METHOD_GET;
  370   2          nexttok = strtok(NULL," ");      
  371   2        }
  372   1        else if (!strcmp(nexttok, "HEAD") || !strcmp(nexttok,"head"))  
  373   1        {
  374   2          request->METHOD = METHOD_HEAD;
  375   2          nexttok = strtok(NULL," ");
  376   2          printf("METHOD = HEAD!\n");    
  377   2                
  378   2        }
  379   1        else if (!strcmp(nexttok, "POST") || !strcmp(nexttok,"post"))
  380   1        {
  381   2          nexttok = strtok(NULL,"\0");
  382   2          request->METHOD = METHOD_POST;
  383   2          printf("METHOD = POST!\n");    
  384   2              
  385   2        }
  386   1        else
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 7   

  387   1        {
  388   2          request->METHOD = METHOD_ERR;        
  389   2          }  
  390   1        
  391   1        if(!nexttok)
  392   1        {
  393   2          request->METHOD = METHOD_ERR;      
  394   2          return;
  395   2        }
  396   1           strcpy((char*)request->URI,nexttok);
  397   1      }
  398          
  399          /*********************************************************************************
  400          * Function Name  : DataLocate
  401          * Description    : ÂØªÊâæÊåáÂÆöÂ≠óÁ¨¶‰ΩçÁΩÆ
  402          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíàÔºåÂØªÊâæÂ≠óÁ¨¶
  403          * Output         : None
  404          * Return         : None
  405          *********************************************************************************/
  406          PINT8 DataLocate(PINT8 buf,char * name)
  407          {
  408   1         PINT8 p;
  409   1         p = strstr((char *)buf,name);
  410   1         if (p==NULL) return NULL;
  411   1         p += strlen(name); 
  412   1         return p;
  413   1      }
  414          
  415          /*********************************************************************************
  416          * Function Name  : GetUriName
  417          * Description    : Ëé∑ÂèñURI
  418          * Input          : URI
  419          * Output         : None
  420          * Return         : None
  421          *********************************************************************************/
  422          unsigned char* GetUriName(char* uri)
  423          {
  424   1        UINT8* uri_name;
  425   1        if(!uri) return 0;
  426   1        memset (tempURI, 0, MAX_URI_SIZE);  
  427   1        strcpy((char*)tempURI,uri);
  428   1        uri_name = (UINT8*)strtok(tempURI," ?");
  429   1        if(strcmp((char *)uri_name,"/")) uri_name++;
  430   1        return uri_name;
  431   1      }
  432          
  433          /*********************************************************************************
  434          * Function Name  : LedControl
  435          * Description    : ledÊéßÂà∂Á®ãÂ∫è
  436          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  437          * Output         : None
  438          * Return         : None
  439          
  440          void LedControl(UINT8 *buf)
  441          {   
  442               ptemp = strstr((char *)buf,"LEDCONTROL");//Êü•ÊâæÊé•Êî∂ÁºìÂÜ≤Âå∫(ÊµèËßàÂô®ËØ∑Ê±Ç‰ø°ÊÅØ)ÔºåÁ°ÆËÆ§ÊòØÂ
             -ê¶ÊúâLEDÊéßÂà∂ËØ∑Ê±Ç
  443               if(ptemp !=NULL)
  444               {
  445                 ptemp = DataLocate((char *)buf,"led1=");
  446               if(ptemp!= NULL)
  447                {              
  448                  
  449                   if(*ptemp =='1')//Êü•Áúãled1ÁöÑÂÄº„ÄÇ‰∏∫1ÂàôÁÅØ‰∫ÆÔºå‰∏∫2ÂàôÁÅ≠ÔºåÊ≠§ÂÄº‰∏éHTMLÁΩëÈ°µ‰∏≠ËÆæÁΩÆÊú
             -âÂÖ≥
  450                   {     
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 8   

  451                    printf("LED1-0N\n");
  452                    R32_PA_CLR |= TACK;
  453                    ptemp = DataLocate((char *)HtmlBuffer,"LED1 Áä∂ÊÄÅÔºö");
  454                    *ptemp++ = 0xc1;
  455                    *ptemp = 0xc1;//(Ê±âÂ≠ó)‰∫ÆÔºö0xc1,0xc1****************
  456                   }
  457                   else
  458                   {
  459                    printf("LED1-0FF\n");
  460                    R32_PA_OUT |= TACK;
  461                    ptemp = DataLocate((char *)HtmlBuffer,"LED1 Áä∂ÊÄÅÔºö");
  462                    *ptemp++ = 0xc3;//(Ê±âÂ≠ó)ÁÅ≠Ôºö0xc3,oxf0****************
  463                    *ptemp = 0xf0;
  464                    }
  465          
  466                 }
  467                ptemp = strstr((char *)buf,"led2=");//Êü•Áúãled2ÁöÑÂÄº„ÄÇ‰∏∫3ÂàôÁÅØ‰∫ÆÔºå‰∏∫4ÂàôÁÅ≠ÔºåÊ≠§ÂÄº‰∏éHTML
             -ÁΩëÈ°µ‰∏≠ËÆæÁΩÆÊúâÂÖ≥
  468                if(ptemp!=NULL )
  469               {
  470                  ptemp+=strlen("led2 ");
  471                  if(*ptemp =='3')
  472                   {  
  473                     printf("LED2-0N\n");
  474                     R32_PA_CLR |= TDI;
  475                     ptemp = DataLocate((char *)HtmlBuffer,"LED2 Áä∂ÊÄÅÔºö");
  476                     *ptemp++ = 0xc1;
  477                     *ptemp = 0xc1;
  478                   }
  479                  else
  480                   {
  481                     printf("LED2-0FF\n");
  482                     R32_PA_OUT |= TDI;
  483                     ptemp = DataLocate((char *)HtmlBuffer,"LED2 Áä∂ÊÄÅÔºö");
  484                     *ptemp++ = 0xc3;
  485                     *ptemp = 0xf0;
  486                   }
  487                  }
  488               }
  489          }
  490          *********************************************************************************/
  491          
  492          /*********************************************************************************
  493          * Function Name  : IpSeting
  494          * Description    : IPËÆæÁΩÆ
  495          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  496          * Output         : None
  497          * Return         : None
  498          *********************************************************************************/
  499          void IpSeting(UINT8 *buf1,UINT8 *buf2)
  500          {
  501   1         char *p=0;
  502   1         UINT8 i;
  503   1         UINT8 tbuf[128];
  504   1         strcpy((char *)tbuf,(char *)buf1);  
  505   1         p = DataLocate((char *)tbuf,"IP");                                                                 /*Ê
             -åáÈíàÂè≥ÁßªÂà∞ip*/                            
  506   1         p++;
  507   1         for(i=0;i<3;i++)
  508   1         {
  509   2         p = strtok((char *)p,".");
  510   2         *buf2++ = atoi((char *)p) ;
  511   2         p=NULL;
  512   2         }
  513   1         p=strtok(p,"&");
  514   1         *buf2++ = atoi((char *)p) ;                        
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 9   

  515   1      }
  516          
  517          /*********************************************************************************
  518          * Function Name  : IpRefrsh
  519          * Description    : Êõ¥Êñ∞IP‰ø°ÊÅØÂà∞webÈ°µÈù¢
  520          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  521          * Output         : None
  522          * Return         : None
  523          *********************************************************************************/
  524          void IpRefrsh(UINT8 *buf,UINT8 *buf2)
  525          {
  526   1         UINT8 s[20],i;
  527   1         char *p;
  528   1         sprintf((char *)s ,"%d.%d.%d.%d ", (UINT16)buf2[0],(UINT16)buf2[1],(UINT16)buf2[2],(UINT16)buf2[3]);/*
             -Â∞ÜÊñ∞ÁöÑIPÊ†ºÂºèÂåñÂà∞setÁºìÂÜ≤Âå∫*/
  529   1         p = DataLocate((char *)buf,"IP type=text value"); 
  530   1         p++;
  531   1         for(i=0;i<strlen((char *)s);i++)                                                                    /*
             -Â∞ÜÊ†ºÂºèÂåñÂà∞setÁºìÂÜ≤Âå∫ÁöÑIPÂÜÖÂÆπÊõ¥Êñ∞Âà∞webÈ°µÈù¢‰ø°ÊÅØ‰∏≠Âéª*/
  532   1         {
  533   2          *p++=s[i];
  534   2         }
  535   1      }
  536          
  537          /*********************************************************************************
  538          * Function Name  : PortSeting
  539          * Description    : Á´ØÂè£ËÆæÁΩÆ
  540          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  541          * Output         : None
  542          * Return         : None
  543          *********************************************************************************/
  544          UINT16  PortSeting (UINT8 *buf)
  545          {
  546   1         char *p;
  547   1         UINT8  s[10],i;
  548   1         UINT16 port = 0;
  549   1         p = DataLocate((char *)buf,"PORT");                                                                  /
             -*‰ªéËØ∑Ê±Ç‰ø°ÊÅØ‰∏≠ÊèêÂèñPort‰ø°ÊÅØ*/
  550   1         if(p !=NULL)
  551   1         {
  552   2         p++;
  553   2         memset(s,0,10);
  554   2         i = 0;
  555   2         while(*p !=0)
  556   2         {
  557   3          s[i++]= *p++;
  558   3         }
  559   2         port = atoi((char *)s);
  560   2         }
  561   1         return port;  
  562   1      }
  563          
  564          /*********************************************************************************
  565          * Function Name  : PortRefresh
  566          * Description    : Êõ¥Êñ∞Port‰ø°ÊÅØÂà∞webÈ°µÈù¢
  567          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  568          * Output         : None
  569          * Return         : None
  570          *********************************************************************************/
  571          void PortRefresh (UINT8 *buf,UINT16 port)
  572          {   
  573   1        UINT8 s[10],i;
  574   1        char *p;
  575   1        sprintf((char *)s ,"%d",(UINT16)port);
  576   1        p = DataLocate((char *)buf,"PORT type=text value="); 
  577   1        for(i=0;i<strlen((char *)s);i++)
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 10  

  578   1        {
  579   2          *p++=s[i];
  580   2        }
  581   1        for(i=0;i<3;i++)
  582   1        {
  583   2          *p++=0x20;
  584   2        }
  585   1      }
  586          
  587          /*********************************************************************************
  588          * Function Name  : TempratureRefresh
  589          * Description    : Êõ¥Êñ∞Temprature‰ø°ÊÅØÂà∞webÈ°µÈù¢
  590          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  591          * Output         : None
  592          * Return         : None
  593          *********************************************************************************/
  594          void TempratureRefresh (UINT8 *buf,UINT8 temp)
  595          {
  596   1         UINT8 s[3],i;
  597   1         char *p;
  598   1         sprintf((char *)s,"%d",temp );                                                                      /*
             -ËÆæÁΩÆÊ∏©Â∫¶‰ø°ÊÅØÔºåÂπ∂Âà∑Êñ∞Âà∞WEBÈ°µÈù¢*/
  599   1         p= DataLocate((char *)buf,"Ê∏©Â∫¶");
  600   1         p++;
  601   1         p++;
  602   1         for(i=0;i<2;i++)
  603   1         {
  604   2          *p++=s[i];
  605   2         }
  606   1      }
  607          
  608          /**********************************************************************************
  609          * Function Name  : CurrentRefresh
  610          * Description    : Êõ¥Êñ∞Current‰ø°ÊÅØÂà∞webÈ°µÈù¢
  611          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  612          * Output         : None
  613          * Return         : None
  614          *********************************************************************************/
  615          void CurrentRefresh (UINT8 *buf,UINT8 curr)
  616          {
  617   1         UINT8 s[3],i;
  618   1         char *p;
  619   1         sprintf((char *)s,"%d",curr );                                                                      /*
             -ËÆæÁΩÆÁîµÊµÅ‰ø°ÊÅØÔºåÂπ∂Âà∑Êñ∞Âà∞WEBÈ°µÈù¢*/
  620   1         p= DataLocate((char *)buf,"ÁîµÊµÅ");
  621   1         p++;
  622   1         p++;
  623   1         for(i=0;i<2;i++)
  624   1         {
  625   2          *p++=s[i];
  626   2         }
  627   1      }
  628          
  629          /**********************************************************************************
  630          * Function Name  : VoltageRefresh
  631          * Description    : Êõ¥Êñ∞Voltage‰ø°ÊÅØÂà∞webÈ°µÈù¢
  632          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  633          * Output         : None
  634          * Return         : None
  635          *********************************************************************************/
  636          void VoltageRefresh (UINT8 *buf,UINT8 volt)
  637          {
  638   1         UINT8 s[3],i;
  639   1         char *p;
  640   1         sprintf((char *)s,"%d",volt );                                                                        
             - /*ËÆæÁΩÆÁîµÂéã‰ø°ÊÅØÔºåÂπ∂Âà∑Êñ∞Âà∞WEBÈ°µÈù¢*/
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 11  

  641   1         p= DataLocate((char *)buf,"ÁîµÂéã");
  642   1         p++;
  643   1         p++;
  644   1         for(i=0;i<2;i++)
  645   1         {
  646   2          *p++=s[i];
  647   2         }
  648   1      }
  649          
  650          /**********************************************************************************
  651          * Function Name  : ADCData
  652          * Description    : ‰ΩøÁî®ÈöèÊú∫Êï∞Ê®°ÊãüADCÊï∞ÊçÆ
  653          * Input          : ÁºìÂÜ≤Âå∫ÊåáÈíà
  654          * Output         : None
  655          * Return         : None
  656          *********************************************************************************/
  657          void ADCData(UINT8 *buf)                                                                                 
             -  /*ÈöèÊú∫Êï∞ÁîüÊàêÔºåÊ®°ÊãüADCÁªìÊûú*/
  658          {
  659   1        *buf++ = 10+(UINT16)rand()%30;
  660   1        *buf++ = 10+(UINT16)rand()%50;
  661   1        *buf = 10+(UINT16)rand()%10;
  662   1      }
  663          
  664          /**********************************************************************************
  665          * Function Name  : WebServer
  666          * Description    : webÊúçÂä°‰∏ªÁ®ãÂ∫è
  667          * Input          : WebServer
  668          * Output         : None
  669          * Return         : None
  670          *********************************************************************************/
  671          void WebServer(void)
  672          {
  673   1        if(flag & RECVDATA )
  674   1        {
  675   2          flag  &= ~RECVDATA;
  676   2          ParseHttpRequest(http_request,RecvBuffer);    
  677   2          switch (http_request->METHOD)  
  678   2          {
  679   3            case METHOD_ERR :  
  680   3            break;
  681   3            case METHOD_HEAD:
  682   3            case METHOD_POST:
  683   3            case METHOD_GET:
  684   3              name = (char*)GetUriName((char *)http_request->URI);
  685   3              if (!strcmp(name, "/")) {http_request->TYPE = PTYPE_HTML;}
  686   3              else { ParseUriType(&http_request->TYPE, name);  }
  687   3              if(http_request->TYPE == PTYPE_CGI)
  688   3              {
  689   4                //LedControl(http_request->URI);//LEDÊéßÂà∂ÈÉ®ÂàÜ
  690   4                ptr1 =  strstr((char *)(http_request->URI),"CH395SETING") ;                                       /*
             -Êü•ÊâæÊé•Êî∂ÁºìÂÜ≤Âå∫(ÊµèËßàÂô®ËØ∑Ê±Ç‰ø°ÊÅØ)ÔºåÁ°ÆËÆ§ÊòØÂê¶ÊúâCH395ËÆæÁΩÆËØ∑Ê±Ç*/
  691   4                if(ptr1 !=NULL)
  692   4                {
  693   5                  ptr1 = strstr((char *)(http_request->URI),"IP");                                                /*‰
             -ªéÊµèËßàÂô®ËØ∑Ê±Ç‰ø°ÊÅØ‰∏≠ÊèêÂèñ IP ‰ø°ÊÅØ*/
  694   5                  if (ptr1 !=NULL)
  695   5                  {
  696   6                    printf("******IPËÆ°ÁÆó****************************************\n");
  697   6                    IpSeting((http_request->URI),ipp);
  698   6                    printf("New IP address = %d.%d.%d.%d\n",(UINT16)ipp[0],(UINT16)ipp[1],(UINT16)ipp[2],(UINT16)ipp[3
             -]);        
  699   6                    i = memcmp(lastip,ipp,4);                                                                         
             -/*‰∏é‰∏ä‰∏ÄÊ¨°ÊèêÂèñÁöÑIPËøõË°åÂØπÊØîÔºåÊü•ÁúãÊòØÂê¶ÊîπÂèòÔºåÂ¶ÇÊûúÊîπÂèòÂàôÈ°∫Â∫èÊâßË°å‰∏ãÈù¢ÁöÑIPËÆæÁΩÆÈÉ®ÂàÜÔºåÂê¶Âàô
             -Ë∑≥Ëøá*/
  700   6                    if(i){                                                                                           /
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 12  

             -*IPÊîπÂèò*/
  701   7                      flag |=IPCHANGE;                                                                            /*IPÊ
             -îπÂèòÔºåflagÊ†áÂøó‰Ωç0ÁΩÆ1*/
  702   7                      printf("ip change\n");
  703   7                      memcpy (CH395IPAddr,ipp,4);                                                                  /*Êõ
             -¥Êñ∞CH395ÁöÑIP‰ø°ÊÅØ*/
  704   7                      memcpy (lastip,ipp,4);                                                                       /*Êñ
             -∞ÁöÑIPÂÄºËµãÁªôÂâç‰∏ÄÊ¨°ÔºåÊñπ‰æø‰∏ãÊ¨°ÊØîËæÉ*/
  705   7                      IpRefrsh(HtmlBuffer,ipp);
  706   7                    }
  707   6                  }            
  708   5      
  709   5                  ptr1 = strstr((char *)(http_request->URI),"PORT");                                                /
             -*‰ªéËØ∑Ê±Ç‰ø°ÊÅØ‰∏≠ÊèêÂèñPort‰ø°ÊÅØ*/   
  710   5                  if (ptr1 !=NULL)
  711   5                  {
  712   6                    printf("******PORTËÆ°ÁÆó****************************************\n");
  713   6                    port = PortSeting(http_request->URI);
  714   6                    printf("New Port = %2d\n",(UINT16)port);
  715   6                    if(port != lastport)                                                                             /
             -*‰∏é‰∏ä‰∏ÄÊ¨°ÊèêÂèñÁöÑPortËøõË°åÂØπÊØîÔºåÊü•ÁúãÊòØÂê¶ÊîπÂèòÔºåÂ¶ÇÊûúÊîπÂèòÂàôÈ°∫Â∫èÊâßË°å‰∏ãÈù¢ÁöÑPortËÆæÁΩÆÈÉ®ÂàÜÔºåÂê¶
             -ÂàôË∑≥Ëøá*/
  716   6                    {
  717   7                      flag |=PORTCHANGE;                                                                              /
             -*IPÊîπÂèòÔºåflagÊ†áÂøó‰Ωç1ÁΩÆ1*/
  718   7                      Socket0SourPort = port;
  719   7                      lastport = port;
  720   7                      printf("port change\n");
  721   7                      PortRefresh(HtmlBuffer,port);
  722   7                    }
  723   6                  }
  724   5                }
  725   4      
  726   4                ptr1 = strstr((char *)(http_request->URI),"monitor");                                           /*Êü
             -•ÊâæÊé•Êî∂ÁºìÂÜ≤Âå∫(ÊµèËßàÂô®ËØ∑Ê±Ç‰ø°ÊÅØ)ÔºåÁ°ÆËÆ§ÊòØÂê¶ÊúâÊü•ÁúãÁõëÊéß‰ø°ÊÅØËØ∑Ê±Ç*/
  727   4                if(ptr1 !=NULL)
  728   4                {
  729   5                  ADCData(ADC);       
  730   5                  TempratureRefresh(HtmlBuffer,ADC[0]);
  731   5                  CurrentRefresh(HtmlBuffer,ADC[1]);
  732   5                  VoltageRefresh(HtmlBuffer,ADC[2]);
  733   5                }
  734   4              }
  735   3              MakeHttpResponse(httpweb,http_request->TYPE);
  736   3              CH395SendData(0,httpweb,strlen((char*)httpweb));                                                   /*
             -ÂèëÈÄÅÂìçÂ∫îÊä•Êñá*/  
  737   3              mDelaymS(20);
  738   3              i = CH395GetSocketInt(0);                                                                          /*
             -Â∞ÜÊõ¥Êñ∞ÁöÑÊï∞ÊçÆÈÄÅÁªôÊµèËßàÂô®*/
  739   3              len = sizeof(HtmlBuffer);
  740   3              SockInf.RemLen = len;                                                                              /*
             - ‰øùÂ≠òÈïøÂ∫¶ */
  741   3              if(len > 2048)len = 2048;                                                                          /*
             - ÂèëÈÄÅÁºìÂÜ≤Âå∫ÊúÄÂ§ß‰∏∫2048 */
  742   3              CH395SendData(0,HtmlBuffer,len);
  743   3              SockInf.SendLen = len;                                                                             /*
             - ‰øùÂ≠òÂèëÈÄÅÁöÑÈïøÂ∫¶ */                                         
  744   3              SockInf.pSend = HtmlBuffer;                                                                        /*
             - ÂèëÈÄÅÊç¢ÂèñÂå∫ÊåáÈíà */
  745   3          }     
  746   2        }
  747   1      
  748   1      }


Module Information          Static   Overlayable
------------------------------------------------
C251 COMPILER V5.60.0,  HTTTPS                                                             24/03/23  00:55:42  PAGE 13  

  code size            =      3144     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =      7051     ------
  xdata-const size     =    ------     ------
  edata size           =       148     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =      3686     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

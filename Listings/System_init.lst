C251 COMPILER V5.60.0,  System_init                                                        24/03/23  00:55:24  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE System_init
OBJECT MODULE PLACED IN .\Objects\System_init.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\User\System_init.c XSMALL FUNCTIONS(REENTRANT) OPTIMIZE(4,SPEE
                    -D) BROWSE INCDIR(.\Sources\User;.\Sources\User\include;.\Sources\FreeRTOS\include;.\Sources\FreeRTOS\portable\STC32G12K1
                    -28;.\Sources\Driver\inc;.\Sources\Task\inc;.\Sources\ch395) DEBUG PRINT(.\Listings\System_init.lst) TABS(2) OBJECT(.\Obj
                    -ects\System_init.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* å¦‚æœè¦åœ¨ç¨‹åºä¸­ä½¿ç”¨æ­¤ä»£ç ,è¯·åœ¨ç¨‹åºä¸­æ³¨æ˜ä½¿ç”¨äº†STCçš„èµ„æ–™åŠç¨‹åº            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          #include "FreeRTOS.h"
   14          #include "STC32G_GPIO.h"
   15          #include "STC32G_ADC.h"
   16          #include "STC32G_Exti.h"
   17          #include "STC32G_I2C.h"
   18          #include "STC32G_SPI.h"
   19          #include "STC32G_Timer.h"
   20          #include "STC32G_UART.h"
   21          #include "STC32G_Compare.h"
   22          #include "STC32G_Delay.h"
   23          #include "STC32G_Switch.h"
   24          #include "STC32G_WDT.h"
   25          #include "STC32G_NVIC.h"
   26          
   27          //========================================================================
   28          //                                IOå£é…ç½®
   29          //========================================================================
   30          void GPIO_config(void)
   31          {
   32   1        P0_MODE_IO_PU(GPIO_Pin_All);    //P0 è®¾ç½®ä¸ºå‡†åŒå‘å£
   33   1        P1_MODE_IO_PU(GPIO_Pin_All);    //P1 è®¾ç½®ä¸ºå‡†åŒå‘å£
   34   1        P1_MODE_IN_HIZ(GPIO_Pin_LOW);   //P1.0~P1.3 è®¾ç½®ä¸ºé«˜é˜»è¾“å…¥
   35   1        P1_MODE_OUT_OD(GPIO_Pin_4 | GPIO_Pin_5); //P1.4,P1.5 è®¾ç½®ä¸ºæ¼æå¼€è·¯
   36   1        P2_MODE_IO_PU(GPIO_Pin_All);    //P2 è®¾ç½®ä¸ºå‡†åŒå‘å£
   37   1        P3_MODE_IO_PU(GPIO_Pin_All);    //P3 è®¾ç½®ä¸ºå‡†åŒå‘å£
   38   1        P4_MODE_IO_PU(GPIO_Pin_All);    //P4 è®¾ç½®ä¸ºå‡†åŒå‘å£
   39   1        P5_MODE_IO_PU(GPIO_Pin_All);    //P5 è®¾ç½®ä¸ºå‡†åŒå‘å£
   40   1        P6_MODE_IO_PU(GPIO_Pin_All);    //P6 è®¾ç½®ä¸ºå‡†åŒå‘å£
   41   1        P7_MODE_IO_PU(GPIO_Pin_All);    //P7 è®¾ç½®ä¸ºå‡†åŒå‘å£
   42   1        
   43   1        P1_PULL_UP_ENABLE(GPIO_Pin_4 | GPIO_Pin_5); //P1.4,P1.5 å¼€å¯å†…éƒ¨ä¸Šæ‹‰
   44   1      }
   45          
   46          //========================================================================
   47          //                               å®šæ—¶å™¨é…ç½®
   48          //========================================================================
   49          void Timer_config(void)
   50          {
   51   1      //  TIM_InitTypeDef   TIM_InitStructure;            //ç»“æ„å®šä¹‰
   52   1      //  TIM_InitStructure.TIM_Mode      = TIM_16BitAutoReload;  //æŒ‡å®šå·¥ä½œæ¨¡å¼,   TIM_16BitAutoReload,TIM
             -_16Bit,TIM_8BitAutoReload,TIM_16BitAutoReloadNoMask
   53   1      //  TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_1T;   //æŒ‡å®šæ—¶é’Ÿæº,     TIM_CLOCK_1T,TIM_CLOCK_12T,TIM
             -_CLOCK_Ext
   54   1      //  TIM_InitStructure.TIM_ClkOut    = DISABLE;        //æ˜¯å¦è¾“å‡ºé«˜é€Ÿè„‰å†², ENABLEæˆ–DISABLE
C251 COMPILER V5.60.0,  System_init                                                        24/03/23  00:55:24  PAGE 2   

   55   1      //  TIM_InitStructure.TIM_Value     = (uint16_t)(65536UL - (MAIN_Fosc / 1000UL));   //ä¸­æ–­é¢‘ç‡, 1000æ¬¡
             -/ç§’
   56   1      //  TIM_InitStructure.TIM_Run       = ENABLE;         //æ˜¯å¦åˆå§‹åŒ–åå¯åŠ¨å®šæ—¶å™¨, ENABLEæˆ–DISABLE
   57   1      //  Timer_Inilize(Timer0,&TIM_InitStructure);         //åˆå§‹åŒ–Timer0   Timer0,Timer1,Timer2,Timer3,Timer4
   58   1      //  NVIC_Timer0_Init(ENABLE,Priority_0);    //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,
             -Priority_1,Priority_2,Priority_3
   59   1      
   60   1      //  //å®šæ—¶å™¨1åš16ä½è‡ªåŠ¨é‡è£…, ä¸­æ–­é¢‘ç‡ä¸º20000HZï¼Œä¸­æ–­å‡½æ•°ä»P6.6å–åè¾“å‡º10KHZæ–¹æ³¢ä
             -¿¡å·.
   61   1      //  TIM_InitStructure.TIM_Mode      = TIM_16BitAutoReload;  //æŒ‡å®šå·¥ä½œæ¨¡å¼,   TIM_16BitAutoReload,TIM
             -_16Bit,TIM_8BitAutoReload,TIM_16BitAutoReloadNoMask
   62   1      //  TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_1T;   //æŒ‡å®šæ—¶é’Ÿæº, TIM_CLOCK_1T,TIM_CLOCK_12T,TIM_CLO
             -CK_Ext
   63   1      //  TIM_InitStructure.TIM_ClkOut    = DISABLE;        //æ˜¯å¦è¾“å‡ºé«˜é€Ÿè„‰å†², ENABLEæˆ–DISABLE
   64   1      //  TIM_InitStructure.TIM_Value     = 65536UL - (MAIN_Fosc / 20000);      //ä¸­æ–­é¢‘ç‡, 20000æ¬¡/ç§’
   65   1      //  TIM_InitStructure.TIM_Run       = ENABLE;         //æ˜¯å¦åˆå§‹åŒ–åå¯åŠ¨å®šæ—¶å™¨, ENABLEæˆ–DISABLE
   66   1      //  Timer_Inilize(Timer1,&TIM_InitStructure);         //åˆå§‹åŒ–Timer1   Timer0,Timer1,Timer2,Timer3,Timer4
   67   1      //  NVIC_Timer1_Init(ENABLE,Priority_0);    //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,
             -Priority_1,Priority_2,Priority_3
   68   1      
   69   1      //  //å®šæ—¶å™¨2åš16ä½è‡ªåŠ¨é‡è£…, ä¸­æ–­é¢‘ç‡ä¸º10000HZï¼Œä¸­æ–­å‡½æ•°ä»P6.5å–åè¾“å‡º5KHZæ–¹æ³¢ä¿
             -¡å·.
   70   1      //  TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_1T;   //æŒ‡å®šæ—¶é’Ÿæº,     TIM_CLOCK_1T,TIM_CLOCK_12T,TIM
             -_CLOCK_Ext
   71   1      //  TIM_InitStructure.TIM_ClkOut    = DISABLE;        //æ˜¯å¦è¾“å‡ºé«˜é€Ÿè„‰å†², ENABLEæˆ–DISABLE
   72   1      //  TIM_InitStructure.TIM_Value     = 65536UL - (MAIN_Fosc / 10000);        //åˆå€¼
   73   1      //  TIM_InitStructure.TIM_Run       = ENABLE;         //æ˜¯å¦åˆå§‹åŒ–åå¯åŠ¨å®šæ—¶å™¨, ENABLEæˆ–DISABLE
   74   1      //  Timer_Inilize(Timer2,&TIM_InitStructure);         //åˆå§‹åŒ–Timer2   Timer0,Timer1,Timer2,Timer3,Timer4
   75   1      //  NVIC_Timer2_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
   76   1      
   77   1      //  //å®šæ—¶å™¨3åš16ä½è‡ªåŠ¨é‡è£…, ä¸­æ–­é¢‘ç‡ä¸º100HZï¼Œä¸­æ–­å‡½æ•°ä»P6.4å–åè¾“å‡º50HZæ–¹æ³¢ä¿¡å
             -·.
   78   1      //  TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_12T;  //æŒ‡å®šæ—¶é’Ÿæº,     TIM_CLOCK_1T,TIM_CLOCK_12T,TIM
             -_CLOCK_Ext
   79   1      //  TIM_InitStructure.TIM_ClkOut    = ENABLE;         //æ˜¯å¦è¾“å‡ºé«˜é€Ÿè„‰å†², ENABLEæˆ–DISABLE
   80   1      //  TIM_InitStructure.TIM_Value     = 65536UL - (MAIN_Fosc / (100*12));   //åˆå€¼
   81   1      //  TIM_InitStructure.TIM_Run       = ENABLE;         //æ˜¯å¦åˆå§‹åŒ–åå¯åŠ¨å®šæ—¶å™¨, ENABLEæˆ–DISABLE
   82   1      //  Timer_Inilize(Timer3,&TIM_InitStructure);         //åˆå§‹åŒ–Timer3   Timer0,Timer1,Timer2,Timer3,Timer4
   83   1      //  NVIC_Timer3_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
   84   1      
   85   1      //  //å®šæ—¶å™¨4åš16ä½è‡ªåŠ¨é‡è£…, ä¸­æ–­é¢‘ç‡ä¸º50HZï¼Œä¸­æ–­å‡½æ•°ä»P6.3å–åè¾“å‡º25HZæ–¹æ³¢ä¿¡å
             -·.
   86   1      //  TIM_InitStructure.TIM_ClkSource = TIM_CLOCK_12T;  //æŒ‡å®šæ—¶é’Ÿæº,     TIM_CLOCK_1T,TIM_CLOCK_12T,TIM
             -_CLOCK_Ext
   87   1      //  TIM_InitStructure.TIM_ClkOut    = ENABLE;         //æ˜¯å¦è¾“å‡ºé«˜é€Ÿè„‰å†², ENABLEæˆ–DISABLE
   88   1      //  TIM_InitStructure.TIM_Value     = 65536UL - (MAIN_Fosc / (50*12));    //åˆå€¼
   89   1      //  TIM_InitStructure.TIM_Run       = ENABLE;         //æ˜¯å¦åˆå§‹åŒ–åå¯åŠ¨å®šæ—¶å™¨, ENABLEæˆ–DISABLE
   90   1      //  Timer_Inilize(Timer4,&TIM_InitStructure);         //åˆå§‹åŒ–Timer4   Timer0,Timer1,Timer2,Timer3,Timer4
   91   1      //  NVIC_Timer4_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
   92   1      }
   93          
   94          //========================================================================
   95          //                              ADCåˆå§‹åŒ–
   96          //========================================================================
   97          void ADC_config(void)
   98          {
   99   1        ADC_InitTypeDef   ADC_InitStructure;    //ç»“æ„å®šä¹‰
  100   1        ADC_InitStructure.ADC_SMPduty   = 31;   //ADC æ¨¡æ‹Ÿä¿¡å·é‡‡æ ·æ—¶é—´æ§åˆ¶, 0~31ï¼ˆæ³¨æ„ï¼š SMPDUTY ä¸
             -€å®šä¸èƒ½è®¾ç½®å°äº 10ï¼‰
  101   1        ADC_InitStructure.ADC_CsSetup   = 0;    //ADC é€šé“é€‰æ‹©æ—¶é—´æ§åˆ¶ 0(é»˜è®¤),1
  102   1        ADC_InitStructure.ADC_CsHold    = 1;    //ADC é€šé“é€‰æ‹©ä¿æŒæ—¶é—´æ§åˆ¶ 0,1(é»˜è®¤),2,3
  103   1        ADC_InitStructure.ADC_Speed     = ADC_SPEED_2X1T;   //è®¾ç½® ADC å·¥ä½œæ—¶é’Ÿé¢‘ç‡ ADC_SPEED_2X1T~ADC_SP
             -EED_2X16T
  104   1        ADC_InitStructure.ADC_AdjResult = ADC_RIGHT_JUSTIFIED;  //ADCç»“æœè°ƒæ•´,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_J
             -USTIFIED
  105   1        ADC_Inilize(&ADC_InitStructure);        //åˆå§‹åŒ–
C251 COMPILER V5.60.0,  System_init                                                        24/03/23  00:55:24  PAGE 3   

  106   1        ADC_PowerControl(ENABLE);         //ADCç”µæºå¼€å…³, ENABLEæˆ–DISABLE
  107   1        NVIC_ADC_Init(DISABLE,Priority_0);        //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,
             -Priority_1,Priority_2,Priority_3
  108   1      }
  109          
  110          //========================================================================
  111          //                              ä¸²å£åˆå§‹åŒ–
  112          //========================================================================
  113          void UART_config(void)
  114          {
  115   1        COMx_InitDefine   COMx_InitStructure;         //ç»“æ„å®šä¹‰
  116   1      
  117   1      //  COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;     //æ¨¡å¼, UART_ShiftRight,UART_8bit_BRTx,UART_
             -9bit,UART_9bit_BRTx
  118   1      //  COMx_InitStructure.UART_BRT_Use   = BRT_Timer1;     //é€‰æ‹©æ³¢ç‰¹ç‡å‘ç”Ÿå™¨, BRT_Timer1, BRT_Timer2 (
             -æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)
  119   1      //  COMx_InitStructure.UART_BaudRate  = 115200ul;     //æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200
  120   1      //  COMx_InitStructure.UART_RxEnable  = ENABLE;       //æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE
  121   1      //  COMx_InitStructure.BaudRateDouble = DISABLE;      //æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE
  122   1      //  UART_Configuration(UART1, &COMx_InitStructure);       //åˆå§‹åŒ–ä¸²å£1 UART1,UART2,UART3,UART4
  123   1      //  NVIC_UART1_Init(ENABLE,Priority_1);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,P
             -riority_1,Priority_2,Priority_3
  124   1      
  125   1        COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;   //æ¨¡å¼,   UART_ShiftRight,UART_8bit_BRTx,UART_9bi
             -t,UART_9bit_BRTx
  126   1      //  COMx_InitStructure.UART_BRT_Use   = BRT_Timer2;     //é€‰æ‹©æ³¢ç‰¹ç‡å‘ç”Ÿå™¨, BRT_Timer2 (æ³¨æ„: ä¸²å
             -£2å›ºå®šä½¿ç”¨BRT_Timer2, æ‰€ä»¥ä¸ç”¨é€‰æ‹©)
  127   1        COMx_InitStructure.UART_BaudRate  = 9600ul;     //æ³¢ç‰¹ç‡,     110 ~ 115200
  128   1        COMx_InitStructure.UART_RxEnable  = ENABLE;       //æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE
  129   1        UART_Configuration(UART2, &COMx_InitStructure);       //åˆå§‹åŒ–ä¸²å£2 UART1,UART2,UART3,UART4
  130   1        NVIC_UART2_Init(ENABLE,Priority_1);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Pri
             -ority_1,Priority_2,Priority_3
  131   1      
  132   1        COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;   //æ¨¡å¼, UART_ShiftRight,UART_8bit_BRTx,UART_9bit,
             -UART_9bit_BRTx
  133   1        COMx_InitStructure.UART_BRT_Use   = BRT_Timer3;     //é€‰æ‹©æ³¢ç‰¹ç‡å‘ç”Ÿå™¨, BRT_Timer3, BRT_Timer2 (æ³
             -¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)
  134   1        COMx_InitStructure.UART_BaudRate  = 115200ul;     //æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200
  135   1        COMx_InitStructure.UART_RxEnable  = ENABLE;       //æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE
  136   1        UART_Configuration(UART3, &COMx_InitStructure);       //åˆå§‹åŒ–ä¸²å£1 UART1,UART2,UART3,UART4
  137   1        NVIC_UART3_Init(ENABLE,Priority_1);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Pri
             -ority_1,Priority_2,Priority_3
  138   1      }
  139          
  140          //========================================================================
  141          //                               I2Cåˆå§‹åŒ–
  142          //========================================================================
  143          void I2C_config(void)
  144          {
  145   1        I2C_InitTypeDef   I2C_InitStructure;
  146   1      
  147   1      //  I2C_InitStructure.I2C_Mode      = I2C_Mode_Master;      //ä¸»ä»é€‰æ‹©   I2C_Mode_Master, I2C_Mode_Slav
             -e
  148   1      //  I2C_InitStructure.I2C_Enable    = ENABLE;       //I2CåŠŸèƒ½ä½¿èƒ½,   ENABLE, DISABLE
  149   1      //  I2C_InitStructure.I2C_MS_WDTA   = DISABLE;        //ä¸»æœºä½¿èƒ½è‡ªåŠ¨å‘é€,  ENABLE, DISABLE
  150   1      //  I2C_InitStructure.I2C_Speed     = 16;         //æ€»çº¿é€Ÿåº¦=Fosc/2/(Speed*2+4),      0~63
  151   1      //  I2C_Init(&I2C_InitStructure);
  152   1      //  NVIC_I2C_Init(I2C_Mode_Master,DISABLE,Priority_0);    //ä¸»ä»æ¨¡å¼, I2C_Mode_Master, I2C_Mode_Slave; ä
             -¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Priority_1,Priority_2,Priority_3
  153   1      
  154   1        I2C_InitStructure.I2C_Mode      = I2C_Mode_Slave;   //ä¸»ä»é€‰æ‹©   I2C_Mode_Master, I2C_Mode_Slave
  155   1        I2C_InitStructure.I2C_Enable    = ENABLE;         //I2CåŠŸèƒ½ä½¿èƒ½,   ENABLE, DISABLE
  156   1        I2C_InitStructure.I2C_SL_MA     = ENABLE;       //ä½¿èƒ½ä»æœºåœ°å€æ¯”è¾ƒåŠŸèƒ½,   ENABLE, DISABLE
  157   1        I2C_InitStructure.I2C_SL_ADR    = 0x2d;         //ä»æœºè®¾å¤‡åœ°å€,  0~127  (0x2d<<1 = 0x5a)
  158   1        I2C_Init(&I2C_InitStructure);
  159   1        NVIC_I2C_Init(I2C_Mode_Slave,I2C_ESTAI|I2C_ERXI|I2C_ETXI|I2C_ESTOI,Priority_0); //ä¸»ä»æ¨¡å¼, I2C_Mode
C251 COMPILER V5.60.0,  System_init                                                        24/03/23  00:55:24  PAGE 4   

             -_Master, I2C_Mode_Slave; ä¸­æ–­ä½¿èƒ½, I2C_ESTAI/I2C_ERXI/I2C_ETXI/I2C_ESTOI/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Pr
             -iority_1,Priority_2,Priority_3
  160   1      }
  161          
  162          //========================================================================
  163          //                               SPIåˆå§‹åŒ–
  164          //========================================================================
  165          void SPI_config(void)
  166          {
  167   1        SPI_InitTypeDef   SPI_InitStructure;
  168   1        SPI_InitStructure.SPI_Enable    = ENABLE;         //SPIå¯åŠ¨    ENABLE, DISABLE
  169   1        SPI_InitStructure.SPI_SSIG      = ENABLE;       //ç‰‡é€‰ä½     ENABLE, DISABLE
  170   1        SPI_InitStructure.SPI_FirstBit  = SPI_MSB;        //ç§»ä½æ–¹å‘   SPI_MSB, SPI_LSB
  171   1        SPI_InitStructure.SPI_Mode      = SPI_Mode_Slave;   //ä¸»ä»é€‰æ‹©   SPI_Mode_Master, SPI_Mode_Slave
  172   1        SPI_InitStructure.SPI_CPOL      = SPI_CPOL_Low;     //æ—¶é’Ÿç›¸ä½   SPI_CPOL_High,   SPI_CPOL_Low
  173   1        SPI_InitStructure.SPI_CPHA      = SPI_CPHA_2Edge;   //æ•°æ®è¾¹æ²¿   SPI_CPHA_1Edge,  SPI_CPHA_2Edge
  174   1        SPI_InitStructure.SPI_Speed     = SPI_Speed_4;      //SPIé€Ÿåº¦    SPI_Speed_4, SPI_Speed_8, SPI_Speed_16, 
             -SPI_Speed_32/SPI_Speed_2
  175   1        SPI_Init(&SPI_InitStructure);
  176   1        NVIC_SPI_Init(ENABLE,Priority_3);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Prior
             -ity_1,Priority_2,Priority_3
  177   1      }
  178          
  179          //========================================================================
  180          //                             æ¯”è¾ƒå™¨åˆå§‹åŒ–
  181          //========================================================================
  182          void CMP_config(void)
  183          {
  184   1        CMP_InitDefine CMP_InitStructure;           //ç»“æ„å®šä¹‰
  185   1        CMP_InitStructure.CMP_EN = ENABLE;                //å…è®¸æ¯”è¾ƒå™¨   ENABLE,DISABLE
  186   1        CMP_InitStructure.CMP_P_Select     = CMP_P_P37;   //æ¯”è¾ƒå™¨è¾“å…¥æ­£æé€‰æ‹©, CMP_P_P37/CMP_P_P50/CMP_
             -P_P51, CMP_P_ADC: ç”±ADCæ¨¡æ‹Ÿè¾“å…¥ç«¯åšæ­£è¾“å…¥.
  187   1        CMP_InitStructure.CMP_N_Select     = CMP_N_GAP;   //æ¯”è¾ƒå™¨è¾“å…¥è´Ÿæé€‰æ‹©, CMP_N_GAP: é€‰æ‹©å†…éƒ¨B
             -andGapç»è¿‡OPåçš„ç”µå‹åšè´Ÿè¾“å…¥, CMP_N_P36: é€‰æ‹©P3.6åšè´Ÿè¾“å…¥.
  188   1        CMP_InitStructure.CMP_InvCMPO      = DISABLE;     //æ¯”è¾ƒå™¨è¾“å‡ºå–å,  ENABLE,DISABLE
  189   1        CMP_InitStructure.CMP_100nsFilter  = ENABLE;      //å†…éƒ¨0.1uFæ»¤æ³¢,    ENABLE,DISABLE
  190   1        CMP_InitStructure.CMP_Outpt_En     = ENABLE;      //å…è®¸æ¯”è¾ƒç»“æœè¾“å‡º,ENABLE,DISABLE
  191   1        CMP_InitStructure.CMP_OutDelayDuty = 16;          //æ¯”è¾ƒç»“æœå˜åŒ–å»¶æ—¶å‘¨æœŸæ•°, 0~63
  192   1        CMP_Inilize(&CMP_InitStructure);        //åˆå§‹åŒ–æ¯”è¾ƒå™¨
  193   1        NVIC_CMP_Init(RISING_EDGE|FALLING_EDGE,Priority_0); //ä¸­æ–­ä½¿èƒ½, RISING_EDGE/FALLING_EDGE/DISABLE; ä¼
             -˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Priority_1,Priority_2,Priority_3
  194   1      }
  195          //========================================================================
  196          //                             å¤–éƒ¨ä¸­æ–­åˆå§‹åŒ–
  197          //========================================================================
  198          void Exti_config(void)
  199          {
  200   1        EXTI_InitTypeDef  Exti_InitStructure;             //ç»“æ„å®šä¹‰
  201   1      
  202   1        Exti_InitStructure.EXTI_Mode      = EXT_MODE_Fall;//ä¸­æ–­æ¨¡å¼,   EXT_MODE_RiseFall,EXT_MODE_Fall
  203   1        Ext_Inilize(EXT_INT0,&Exti_InitStructure);        //åˆå§‹åŒ–
  204   1        NVIC_INT0_Init(ENABLE,Priority_0);    //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Prio
             -rity_1,Priority_2,Priority_3
  205   1      
  206   1        Exti_InitStructure.EXTI_Mode      = EXT_MODE_Fall;//ä¸­æ–­æ¨¡å¼,   EXT_MODE_RiseFall,EXT_MODE_Fall
  207   1        Ext_Inilize(EXT_INT1,&Exti_InitStructure);        //åˆå§‹åŒ–
  208   1        NVIC_INT1_Init(ENABLE,Priority_0);    //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½åˆ°é«˜) Priority_0,Prio
             -rity_1,Priority_2,Priority_3
  209   1      
  210   1        NVIC_INT2_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
  211   1        NVIC_INT3_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
  212   1        NVIC_INT4_Init(ENABLE,0);   //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; æ— ä¼˜å…ˆçº§
  213   1      }
  214          
  215          //========================================================================
  216          //                             å¤–éƒ¨ä¸­æ–­åˆå§‹åŒ–
C251 COMPILER V5.60.0,  System_init                                                        24/03/23  00:55:24  PAGE 5   

  217          //========================================================================
  218          
  219          //========================================================================
  220          //                               åŠŸèƒ½è„šåˆ‡æ¢
  221          //========================================================================
  222          void Switch_config(void)
  223          {
  224   1        UART1_SW(UART1_SW_P30_P31);   //UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17,UART1_SW_P43_P44
  225   1        UART2_SW(UART2_SW_P46_P47);   //UART2_SW_P10_P11,UART2_SW_P46_P47
  226   1        UART3_SW(UART3_SW_P50_P51);   //UART3_SW_P00_P01,UART3_SW_P50_P51
  227   1        UART4_SW(UART4_SW_P02_P03);   //UART4_SW_P02_P03,UART4_SW_P52_P53
  228   1        I2C_SW(I2C_P33_P32);      //I2C_P14_P15,I2C_P24_P25,I2C_P76_P77,I2C_P33_P32
  229   1      //  COMP_SW(CMP_OUT_P34);     //CMP_OUT_P34,CMP_OUT_P41
  230   1        SPI_SW(SPI_P22_P23_P24_P25);  //SPI_P54_P13_P14_P15,SPI_P22_P23_P24_P25,SPI_P54_P40_P41_P43,SPI_P35_P34_P
             -33_P32
  231   1      
  232   1        LCM_CTRL_SW(LCM_CTRL_P45_P44_P42);  //LCM_CTRL_P45_P44_P42,LCM_CTRL_P45_P37_P36,LCM_CTRL_P40_P44_P42,LCM_
             -CTRL_P40_P37_P36
  233   1        LCM_DATA_SW(LCM_D8_NA_P6);    //LCM_D8_NA_P2,LCM_D8_NA_P6 / LCM_D16_P2_P0,LCM_D16_P6_P2,LCM_D16_P2_P7P4,LC
             -M_D16_P6_P7
  234   1      }
  235          
  236          //========================================================================
  237          //                                ç³»ç»Ÿåˆå§‹åŒ–
  238          //========================================================================
  239          void vSystemInit(void)
  240          {
  241   1          WTST = 0;     //è®¾ç½®ç¨‹åºæŒ‡ä»¤å»¶æ—¶å‚æ•°ï¼Œèµ‹å€¼ä¸º0å¯å°†CPUæ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦è®¾ç½®ä¸ºæœ€
             -å¿«
  242   1          EAXFR = 1;    //æ‰©å±•å¯„å­˜å™¨(XFR)è®¿é—®ä½¿èƒ½
  243   1          CKCON = 0;    //æé«˜è®¿é—®XRAMé€Ÿåº¦
  244   1      
  245   1        GPIO_config();
  246   1      //  Timer_config();
  247   1        ADC_config();
  248   1        UART_config();
  249   1      //  Exti_config();
  250   1        I2C_config();
  251   1      //  SPI_config();
  252   1      //  CMP_config();
  253   1        Switch_config();
  254   1        
  255   1      }
  256          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       574     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

C251 COMPILER V5.60.0,  main                                                               24/03/23  00:55:23  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE main
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Sources\User\main.c XSMALL FUNCTIONS(REENTRANT) OPTIMIZE(4,SPEED) BROW
                    -SE INCDIR(.\Sources\User;.\Sources\User\include;.\Sources\FreeRTOS\include;.\Sources\FreeRTOS\portable\STC32G12K128;.\So
                    -urces\Driver\inc;.\Sources\Task\inc;.\Sources\ch395) DEBUG PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)
                    - 

stmt  level    source

    1          
    2          /*
    3           * FreeRTOS STC port V1.0.2
    4           * 
    5           * STC32G12K128åŠŸèƒ½ç®€ä»‹ï¼š
    6           *    2ç»„ CAN, 3ç»„Lin, USB, 32ä½ 8051, RMB5,
    7           *    é«˜ç²¾å‡†12ä½ADC, DMA æ”¯æŒ(TFTå½©å±, ADC, 4ç»„ä¸²å£, SPI, I2C )
    8           *  
    9           *  å„ä½ç”¨æˆ·åœ¨åç»­çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°æœ‰ä¸æ­£ç¡®çš„åœ°æ–¹æˆ–è€…
   10           *  æœ‰å¯æ”¹å–„çš„åœ°æ–¹ï¼Œè¯·å’ŒSTCè”ç³»ï¼Œç”±STCå®˜æ–¹è¿›è¡Œç»Ÿä¸€ä¿®æ”¹å¹¶æ›´æ–°ç‰ˆæœ¬
   11           *
   12           *  è‹¥æ‚¨çš„ä»£ç æˆ–æ–‡ç« ä¸­éœ€è¦å¼•ç”¨æœ¬ç¨‹åºåŒ…ä¸­çš„éƒ¨åˆ†ç§»æ¤ä»£ç ï¼Œè¯·åœ¨æ‚¨çš„
   13           *  ä»£ç æˆ–æ–‡ç« ä¸­æ³¨æ˜å‚è€ƒæˆ–ä½¿ç”¨äº†STCçš„FreeRTOSçš„ç§»æ¤ä»£ç 
   14          */
   15          
   16          #include "FreeRTOS.h"
   17          #include "task.h"
   18          #include "System_init.h"
   19          
   20          #include "display.h"
   21          #include "rtc.h"
   22          #include "ntc.h"
   23          #include "adckey.h"
   24          #include "uart2_3.h"
   25          #include "MatrixKey.h"
   26          #include "i2c_ps.h"
   27          #include "pwmb.h"
   28          //#include "ch395.h"
   29          //#include "task_uart1.h"
   30          #include <STC32G.H>
   31          #include "usb.h"
   32          
   33          
   34          
   35          
   36          
   37          
   38          
   39              //P3.2å£æŒ‰é”®å¤ä½æ‰€éœ€å˜é‡
   40              bit Key_Flag;
   41              u16 Key_cnt;
   42          
   43          
   44          void KeyResetScan(void);
   45          
   46          void vSystemInit( void );
   47          
   48          //void timer4_int (void) interrupt 1 //1æ¯«ç§’ä¸­æ–­å‡½æ•°
   49          //{
   50            //P3.2å£æŒ‰å¥è§¦å‘è½¯ä»¶å¤ä½ï¼Œè¿›å…¥USBä¸‹è½½æ¨¡å¼
   51            //KeyResetScan();
   52          //}
   53          
   54          
   55          
   56          void main( void )
C251 COMPILER V5.60.0,  main                                                               24/03/23  00:55:23  PAGE 2   

   57          {
   58   1        //USBè°ƒè¯•åŠå¤ä½æ‰€éœ€å®šä¹‰
   59   1          //char *USER_DEVICEDESC = NULL;
   60   1          //char *USER_PRODUCTDESC = NULL;
   61   1          //char *USER_STCISPCMD = "@STCISP#";//è®¾ç½®è‡ªåŠ¨å¤ä½åˆ°ISPåŒºçš„ç”¨æˆ·æ¥å£å‘½ä»¤
   62   1          //USBè°ƒè¯•åŠå¤ä½æ‰€éœ€ä»£ç 
   63   1          //P3M0 &= ~0x03;
   64   1          //P3M1 |=0x03;
   65   1          //IRC48MCR = 0x80;
   66   1          //while(!(IRC48MCR & 0x01));
   67   1          //usb_init();
   68   1          //EA=1; //æ‰“å¼€æ€»ä¸­æ–­ 
   69   1          //EUSB = 1;   //IE2ç›¸å…³çš„ä¸­æ–­ä½æ“ä½œä½¿èƒ½åï¼Œéœ€è¦é‡æ–°è®¾ç½®EUSB
   70   1          //USBè°ƒè¯•åŠå¤ä½æ‰€éœ€ä»£ç ï¼Œæ”¾åœ¨å¾ªç¯å‡½æ•°é‡Œ
   71   1          //if(bUsbOutReady) {usb_OUT_done();}
   72   1        
   73   1      
   74   1      
   75   1      
   76   1        
   77   1          /* ç³»ç»Ÿåˆå§‹åŒ– */
   78   1          vSystemInit();
   79   1        
   80   1          //InitCH395InfParam();  /* åˆå§‹åŒ–CH395ç›¸å…³å˜é‡ */
   81   1        
   82   1            
   83   1      
   84   1      
   85   1      
   86   1      
   87   1      
   88   1        /* åˆ›å»ºä»»åŠ¡ */
   89   1        /*
   90   1          xTaskCreate((TaskFunction_t )vDisplayTask,
   91   1                      (const char*    )"DISPLAY",
   92   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
   93   1                      (void*          )NULL,
   94   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES + 1),
   95   1                      (TaskHandle_t*  )NULL);
   96   1          xTaskCreate((TaskFunction_t )vRtcTask,
   97   1                      (const char*    )"RTC",
   98   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
   99   1                      (void*          )NULL,
  100   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES + 1),
  101   1                      (TaskHandle_t*  )NULL);
  102   1          xTaskCreate((TaskFunction_t )vAdcKeyTask,
  103   1                      (const char*    )"ADCKEY",
  104   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  105   1                      (void*          )NULL,
  106   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  107   1                      (TaskHandle_t*  )NULL);
  108   1          xTaskCreate((TaskFunction_t )vNtcTask,
  109   1                      (const char*    )"NTC",
  110   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  111   1                      (void*          )NULL,
  112   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  113   1                      (TaskHandle_t*  )NULL);
  114   1          xTaskCreate((TaskFunction_t )vMatrixKeyTask,
  115   1                      (const char*    )"MatrixKey",
  116   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  117   1                      (void*          )NULL,
  118   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  119   1                      (TaskHandle_t*  )NULL);
  120   1          xTaskCreate((TaskFunction_t )vI2C_PsTask,
  121   1                      (const char*    )"I2C_PS",
  122   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
C251 COMPILER V5.60.0,  main                                                               24/03/23  00:55:23  PAGE 3   

  123   1                      (void*          )NULL,
  124   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  125   1                      (TaskHandle_t*  )NULL);
  126   1          xTaskCreate((TaskFunction_t )vPWMB_LedTask,
  127   1                      (const char*    )"PWMB_LED",
  128   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  129   1                      (void*          )NULL,
  130   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  131   1                      (TaskHandle_t*  )NULL);
  132   1                      */
  133   1      
  134   1                      
  135   1              xTaskCreate((TaskFunction_t )vUart2_3Task,
  136   1                      (const char*    )"UART2_3",
  137   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  138   1                      (void*          )1000,  //æ³¨æ„pvParameterså‚æ•°ä¼ åœ°å€æˆ–è€…ç«‹å³æ•°æ—¶åªæœ‰ä½24ä
             -½æ˜¯æœ‰æ•ˆä½ï¼Œæœ€é«˜8ä½ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨å¡«0. å¯é€šè¿‡å˜é‡æˆ–è€…å¸¸é‡ä¼ é€32å­—èŠ‚æ•°æ®.
  139   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  140   1                      (TaskHandle_t*  )NULL);
  141   1                      
  142   1                      
  143   1                      /*
  144   1          xTaskCreate((TaskFunction_t )vUart1Task,
  145   1                      (const char*    )"UART1",
  146   1                      (uint16_t       )configDEFAULT_STACK_SIZE,
  147   1                      (void*          )1000,  //æ³¨æ„pvParameterså‚æ•°ä¼ åœ°å€æˆ–è€…ç«‹å³æ•°æ—¶åªæœ‰ä½24ä
             -½æ˜¯æœ‰æ•ˆä½ï¼Œæœ€é«˜8ä½ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨å¡«0. å¯é€šè¿‡å˜é‡æˆ–è€…å¸¸é‡ä¼ é€32å­—èŠ‚æ•°æ®.
  148   1                      (UBaseType_t    )(configDEFAULT_PRIORITIES),
  149   1                      (TaskHandle_t*  )NULL);
  150   1                      */
  151   1      
  152   1          /* å¯åŠ¨ä»»åŠ¡è°ƒåº¦å™¨å¼€å§‹ä»»åŠ¡è°ƒåº¦ */
  153   1          vTaskStartScheduler();
  154   1      
  155   1          /* æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šè¿è¡Œåˆ°æ­¤å¤„ */
  156   1          while (1);
  157   1      }
  158          
  159          
  160          
  161          
  162          
  163          void KeyResetScan(void)
  164          {
  165   1          if(!P32)
  166   1          {
  167   2            if (!Key_Flag) {
  168   3              Key_cnt++;
  169   3              //è¿ç»­1000msæœ‰æ•ˆæŒ‰é”®æ£€æµ‹
  170   3              if (Key_cnt >= 1000)
  171   3              {
  172   4                Key_Flag = 1; //è®¾ç½®æŒ‰é”®çŠ¶æ€ï¼Œé˜²æ­¢é‡å¤è§¦å‘
  173   4      
  174   4      
  175   4                USBCON = 0x00;    //æ¸…é™¤USBè®¾ç½®
  176   4                USBCLK = 0x00;
  177   4                 IRC48MCR = 0x00;
  178   4      
  179   4      
  180   4                //delay_ms(10);
  181   4                vTaskDelay(10);
  182   4                IAP_CONTR= 0x60;  //è§¦å‘è½¯ä»¶å¤ä½ï¼Œä»ISPå¼€å§‹æ‰§è¡Œ
  183   4                while (1);
  184   4              }
  185   3            }
  186   2          }
C251 COMPILER V5.60.0,  main                                                               24/03/23  00:55:23  PAGE 4   

  187   1          else
  188   1          {
  189   2            Key_cnt = 0; 
  190   2            Key_Flag=0;
  191   2          }
  192   1      }
  193          
  194          
  195          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       106     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         2     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         8     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

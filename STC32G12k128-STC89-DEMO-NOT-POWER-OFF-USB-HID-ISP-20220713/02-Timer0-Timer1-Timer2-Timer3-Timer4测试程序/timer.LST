C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE timer
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE timer.c XSMALL INTR2 BROWSE DEBUG

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* --- STC MCU Limited ------------------------------------------------*/
    3          /* --- STC 1T Series MCU Demo Programme -------------------------------*/
    4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
    5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
    6          /* --- Tel: 86-0513-55012928,55012929,55012966 ------------------------*/
    7          /* --- Web: www.STCMCU.com --------------------------------------------*/
    8          /* --- Web: www.STCMCUDATA.com  ---------------------------------------*/
    9          /* --- QQ:  800003751 -------------------------------------------------*/
   10          /* Èç¹ûÒªÔÚ³ÌÐòÖÐÊ¹ÓÃ´Ë´úÂë,ÇëÔÚ³ÌÐòÖÐ×¢Ã÷Ê¹ÓÃÁËSTCµÄ×ÊÁÏ¼°³ÌÐò            */
   11          /*---------------------------------------------------------------------*/
   12          
   13          /*************  ¹¦ÄÜËµÃ÷    **************
   14          
   15          ±¾Àý³Ì»ùÓÚSTC32G×ªSTC89ÏµÁÐ×ª½Ó°å£¨½µÁú¹÷£©½øÐÐ±àÐ´²âÊÔ¡£
   16          
   17          ±¾³ÌÐòÑÝÊ¾5¸ö¶¨Ê±Æ÷µÄÊ¹ÓÃ, ±¾Àý³Ì¾ùÊ¹ÓÃ16Î»×Ô¶¯ÖØ×°.
   18          
   19          ¶¨Ê±Æ÷0×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª1000HZ£¬ÖÐ¶Ïº¯Êý´ÓP1.0È¡·´Êä³ö500HZ·½²¨ÐÅºÅ.
   20          
   21          ¶¨Ê±Æ÷1×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª2000HZ£¬ÖÐ¶Ïº¯Êý´ÓP1.1È¡·´Êä³ö1000HZ·½²¨ÐÅºÅ.
   22          
   23          ¶¨Ê±Æ÷2×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª3000HZ£¬ÖÐ¶Ïº¯Êý´ÓP5.2È¡·´Êä³ö1500HZ·½²¨ÐÅºÅ.
   24          
   25          ¶¨Ê±Æ÷3×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª4000HZ£¬ÖÐ¶Ïº¯Êý´ÓP1.3È¡·´Êä³ö2000HZ·½²¨ÐÅºÅ.
   26          
   27          ¶¨Ê±Æ÷4×ö16Î»×Ô¶¯ÖØ×°, ÖÐ¶ÏÆµÂÊÎª5000HZ£¬ÖÐ¶Ïº¯Êý´ÓP1.4È¡·´Êä³ö2500HZ·½²¨ÐÅºÅ.
   28          
   29          ´ËÍâ³ÌÐòÑÝÊ¾Á½ÖÖ¸´Î»½øÈëUSBÏÂÔØÄ£Ê½µÄ·½·¨£º
   30          1. Í¨¹ýÃ¿1ºÁÃëÖ´ÐÐÒ»´Î¡°KeyResetScan¡±º¯Êý£¬ÊµÏÖ³¤°´P3.2¿Ú°´¼ü´¥·¢MCU¸´Î»£¬½øÈëUSBÏÂÔØÄ£Ê½¡£
   31          2. Í¨¹ý¼ÓÔØ¡°stc_usb_hid_32g.lib¡±¿âº¯Êý£¬ÊµÏÖÊ¹ÓÃSTC-ISPÈí¼þ·¢ËÍÖ¸Áî´¥·¢MCU¸´Î»£¬½øÈëUSBÏÂÔØÄ£Ê½²¢×Ô¶¯ÏÂ
             -ÔØ¡£
   32          
   33          ÏÂÔØÊ±, Ñ¡ÔñÊ±ÖÓ 24MHZ (ÓÃ»§¿É×ÔÐÐÐÞ¸ÄÆµÂÊ).
   34          
   35          ******************************************/
   36          
   37          #include "../comm/STC32G.h"  //°üº¬´ËÍ·ÎÄ¼þºó£¬²»ÐèÒªÔÙ°üº¬"reg51.h"Í·ÎÄ¼þ
   38          #include "../comm/usb.h"     //USBµ÷ÊÔ¼°¸´Î»ËùÐèÍ·ÎÄ¼þ
   39          
   40          #define     MAIN_Fosc       24000000UL  //¶¨ÒåÖ÷Ê±ÖÓ
   41          
   42          #define Timer0_Reload   (MAIN_Fosc / 1000)      //Timer 0 ÖÐ¶ÏÆµÂÊ, 1000´Î/Ãë
   43          #define Timer1_Reload   (MAIN_Fosc / 2000)      //Timer 1 ÖÐ¶ÏÆµÂÊ, 2000´Î/Ãë
   44          #define Timer2_Reload   (MAIN_Fosc / 3000)      //Timer 2 ÖÐ¶ÏÆµÂÊ, 3000´Î/Ãë
   45          #define Timer3_Reload   (MAIN_Fosc / 4000)      //Timer 3 ÖÐ¶ÏÆµÂÊ, 4000´Î/Ãë
   46          #define Timer4_Reload   (MAIN_Fosc / 5000)      //Timer 4 ÖÐ¶ÏÆµÂÊ, 5000´Î/Ãë
   47          
   48          //USBµ÷ÊÔ¼°¸´Î»ËùÐè¶¨Òå
   49          char *USER_DEVICEDESC = NULL;
   50          char *USER_PRODUCTDESC = NULL;
   51          char *USER_STCISPCMD = "@STCISP#";              //ÉèÖÃ×Ô¶¯¸´Î»µ½ISPÇøµÄÓÃ»§½Ó¿ÚÃüÁî
   52          
   53          //P3.2¿Ú°´¼ü¸´Î»ËùÐè±äÁ¿
   54          bit Key_Flag;
   55          u16 Key_cnt;
   56          
   57          void Timer0_init(void);
   58          void Timer1_init(void);
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 2   

   59          void Timer2_init(void);
   60          void Timer3_init(void);
   61          void Timer4_init(void);
   62          
   63          void delay_ms(u8 ms);
   64          void KeyResetScan(void);
   65          
   66          //========================================================================
   67          // º¯Êý: void main(void)
   68          // ÃèÊö: Ö÷º¯Êý.
   69          // ²ÎÊý: none.
   70          // ·µ»Ø: none.
   71          // °æ±¾: V1.0, 2015-1-12
   72          //========================================================================
   73          void main(void)
   74          {
   75   1          WTST = 0;  //ÉèÖÃ³ÌÐòÖ¸ÁîÑÓÊ±²ÎÊý£¬¸³ÖµÎª0¿É½«CPUÖ´ÐÐÖ¸ÁîµÄËÙ¶ÈÉèÖÃÎª×î¿ì
   76   1          EAXFR = 1; //À©Õ¹¼Ä´æÆ÷(XFR)·ÃÎÊÊ¹ÄÜ
   77   1          CKCON = 0; //Ìá¸ß·ÃÎÊXRAMËÙ¶È
   78   1      
   79   1          P0M1 = 0x00;   P0M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   80   1          P1M1 = 0x00;   P1M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   81   1          P2M1 = 0x00;   P2M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   82   1          P3M1 = 0x00;   P3M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   83   1          P4M1 = 0x00;   P4M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   84   1          P5M1 = 0x00;   P5M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   85   1          P6M1 = 0x00;   P6M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   86   1          P7M1 = 0x00;   P7M0 = 0x00;   //ÉèÖÃÎª×¼Ë«Ïò¿Ú
   87   1      
   88   1          //USBµ÷ÊÔ¼°¸´Î»ËùÐè´úÂë-----
   89   1          P3M0 &= ~0x03;
   90   1          P3M1 |= 0x03;
   91   1          IRC48MCR = 0x80;
   92   1          while (!(IRC48MCR & 0x01));
   93   1          usb_init();
   94   1          //-------------------------
   95   1          EA = 1;     //´ò¿ª×ÜÖÐ¶Ï
   96   1          
   97   1          Timer0_init();
   98   1          Timer1_init();
   99   1          Timer2_init();
  100   1          Timer3_init();
  101   1          Timer4_init();
  102   1          EUSB = 1;   //IE2Ïà¹ØµÄÖÐ¶ÏÎ»²Ù×÷Ê¹ÄÜºó£¬ÐèÒªÖØÐÂÉèÖÃEUSB
  103   1      
  104   1          while (1)
  105   1          {
  106   2              if (bUsbOutReady) //USBµ÷ÊÔ¼°¸´Î»ËùÐè´úÂë
  107   2              {
  108   3      //            memcpy(UsbInBuffer, UsbOutBuffer, 64);      //Ô­Â··µ»Ø, ÓÃÓÚ²âÊÔHID
  109   3      //            usb_IN();
  110   3                  
  111   3                  usb_OUT_done();
  112   3              }
  113   2      
  114   2              KeyResetScan();   //P3.2¿Ú°´¼ü´¥·¢Èí¼þ¸´Î»£¬½øÈëUSBÏÂÔØÄ£Ê½£¬²»ÐèÒª´Ë¹¦ÄÜ¿ÉÉ¾³ý±¾ÐÐ´úÂë
  115   2              delay_ms(1);
  116   2          }
  117   1      }
  118          
  119          //========================================================================
  120          // º¯Êý: void Timer0_init(void)
  121          // ÃèÊö: timer0³õÊ¼»¯º¯Êý.
  122          // ²ÎÊý: none.
  123          // ·µ»Ø: none.
  124          // °æ±¾: V1.0, 2015-1-12
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 3   

  125          //========================================================================
  126          void Timer0_init(void)
  127          {
  128   1              TR0 = 0;    //Í£Ö¹¼ÆÊý
  129   1      
  130   1          #if (Timer0_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer0ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer0_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  134   1              ET0 = 1;    //ÔÊÐíÖÐ¶Ï
  135   1          //  PT0 = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  136   1              TMOD &= ~0x03;
  137   1              TMOD |= 0;  //¹¤×÷Ä£Ê½, 0: 16Î»×Ô¶¯ÖØ×°, 1: 16Î»¶¨Ê±/¼ÆÊý, 2: 8Î»×Ô¶¯ÖØ×°, 3: 16Î»×Ô¶¯ÖØ×°, ²»¿ÉÆ
             -Á±ÎÖÐ¶Ï
  138   1          //  T0_CT = 1;  //¼ÆÊý
  139   1              T0_CT = 0;  //¶¨Ê±
  140   1          //  T0CLKO = 1; //Êä³öÊ±ÖÓ
  141   1              T0CLKO = 0; //²»Êä³öÊ±ÖÓ
  142   1      
  143   1              #if (Timer0_Reload < 65536UL)
  144   1                  T0x12 = 1;  //1T mode
  145   1                  TH0 = (u8)((65536UL - Timer0_Reload) / 256);
  146   1                  TL0 = (u8)((65536UL - Timer0_Reload) % 256);
  147   1              #else
                           T0x12 = 0;  //12T mode
                           TH0 = (u8)((65536UL - Timer0_Reload/12) / 256);
                           TL0 = (u8)((65536UL - Timer0_Reload/12) % 256);
                       #endif
  152   1      
  153   1              TR0 = 1;    //¿ªÊ¼ÔËÐÐ
  154   1      
  155   1          #else
                       #error "Timer0ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  158   1      }
  159          
  160          //========================================================================
  161          // º¯Êý: void Timer1_init(void)
  162          // ÃèÊö: timer1³õÊ¼»¯º¯Êý.
  163          // ²ÎÊý: none.
  164          // ·µ»Ø: none.
  165          // °æ±¾: V1.0, 2015-1-12
  166          //========================================================================
  167          void Timer1_init(void)
  168          {
  169   1              TR1 = 0;    //Í£Ö¹¼ÆÊý
  170   1      
  171   1          #if (Timer1_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer1ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer1_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  175   1              ET1 = 1;    //ÔÊÐíÖÐ¶Ï
  176   1          //  PT1 = 1;    //¸ßÓÅÏÈ¼¶ÖÐ¶Ï
  177   1              TMOD &= ~0x30;
  178   1              TMOD |= (0 << 4);   //¹¤×÷Ä£Ê½, 0: 16Î»×Ô¶¯ÖØ×°, 1: 16Î»¶¨Ê±/¼ÆÊý, 2: 8Î»×Ô¶¯ÖØ×°
  179   1          //  T1_CT = 1;  //¼ÆÊý
  180   1              T1_CT = 0;  //¶¨Ê±
  181   1          //  T1CLKO = 1; //Êä³öÊ±ÖÓ
  182   1              T1CLKO = 0; //²»Êä³öÊ±ÖÓ
  183   1      
  184   1              #if (Timer1_Reload < 65536UL)
  185   1                  T1x12 = 1;  //1T mode
  186   1                  TH1 = (u8)((65536UL - Timer1_Reload) / 256);
  187   1                  TL1 = (u8)((65536UL - Timer1_Reload) % 256);
  188   1              #else
                           T1x12 = 0;  //12T mode
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 4   

                           TH1 = (u8)((65536UL - Timer1_Reload/12) / 256);
                           TL1 = (u8)((65536UL - Timer1_Reload/12) % 256);
                       #endif
  193   1      
  194   1              TR1 = 1;    //¿ªÊ¼ÔËÐÐ
  195   1      
  196   1          #else
                       #error "Timer1ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  199   1      }
  200          
  201          //========================================================================
  202          // º¯Êý: void Timer2_init(void)
  203          // ÃèÊö: timer2³õÊ¼»¯º¯Êý.
  204          // ²ÎÊý: none.
  205          // ·µ»Ø: none.
  206          // °æ±¾: V1.0, 2015-1-12
  207          //========================================================================
  208          void Timer2_init(void)
  209          {
  210   1              T2R = 0;    //Í£Ö¹¼ÆÊý
  211   1      
  212   1          #if (Timer2_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer2ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer2_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  216   1              ET2 = 1;    //ÔÊÐíÖÐ¶Ï
  217   1          //  T2_CT = 1;  //¼ÆÊý
  218   1              T2_CT = 0;  //¶¨Ê±
  219   1          //  T2CLKO = 1; //Êä³öÊ±ÖÓ
  220   1              T2CLKO = 0; //²»Êä³öÊ±ÖÓ
  221   1      
  222   1              #if (Timer2_Reload < 65536UL)
  223   1                  T2x12 = 1;    //1T mode
  224   1                  T2H = (u8)((65536UL - Timer2_Reload) / 256);
  225   1                  T2L = (u8)((65536UL - Timer2_Reload) % 256);
  226   1              #else
                           T2x12 = 0;    //12T mode
                           T2H = (u8)((65536UL - Timer2_Reload/12) / 256);
                           T2L = (u8)((65536UL - Timer2_Reload/12) % 256);
                       #endif
  231   1      
  232   1              T2R = 1;    //¿ªÊ¼ÔËÐÐ
  233   1      
  234   1          #else
                       #error "Timer2ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  237   1      }
  238          
  239          //========================================================================
  240          // º¯Êý: void Timer3_init(void)
  241          // ÃèÊö: timer3³õÊ¼»¯º¯Êý.
  242          // ²ÎÊý: none.
  243          // ·µ»Ø: none.
  244          // °æ±¾: V1.0, 2015-1-12
  245          //========================================================================
  246          void Timer3_init(void)
  247          {
  248   1              T3R = 0;    //Í£Ö¹¼ÆÊý
  249   1      
  250   1          #if (Timer3_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer3ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer3_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  254   1              ET3 = 1;    //ÔÊÐíÖÐ¶Ï
  255   1          //  T3_CT = 1;  //¼ÆÊý
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 5   

  256   1              T3_CT = 0;  //¶¨Ê±
  257   1          //  T3CLKO = 1; //Êä³öÊ±ÖÓ
  258   1              T3CLKO = 0; //²»Êä³öÊ±ÖÓ
  259   1      
  260   1              #if (Timer3_Reload < 65536UL)
  261   1                  T3x12 = 1;    //1T mode
  262   1                  T3H = (u8)((65536UL - Timer3_Reload) / 256);
  263   1                  T3L = (u8)((65536UL - Timer3_Reload) % 256);
  264   1              #else
                           T3x12 = 0;    //12T mode
                           T3H = (u8)((65536UL - Timer3_Reload/12) / 256);
                           T3L = (u8)((65536UL - Timer3_Reload/12) % 256);
                       #endif
  269   1      
  270   1              T3R = 1;    //¿ªÊ¼ÔËÐÐ
  271   1      
  272   1          #else
                       #error "Timer3ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  275   1      }
  276          
  277          //========================================================================
  278          // º¯Êý: void Timer4_init(void)
  279          // ÃèÊö: timer4³õÊ¼»¯º¯Êý.
  280          // ²ÎÊý: none.
  281          // ·µ»Ø: none.
  282          // °æ±¾: V1.0, 2015-1-12
  283          //========================================================================
  284          void Timer4_init(void)
  285          {
  286   1              T4R = 0;    //Í£Ö¹¼ÆÊý
  287   1      
  288   1          #if (Timer4_Reload < 64)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
                       #error "Timer4ÉèÖÃµÄÖÐ¶Ï¹ý¿ì!"
               
                   #elif ((Timer4_Reload/12) < 65536UL)    // Èç¹ûÓÃ»§ÉèÖÃÖµ²»ºÏÊÊ£¬ Ôò²»Æô¶¯¶¨Ê±Æ÷
  292   1              ET4 = 1;    //ÔÊÐíÖÐ¶Ï
  293   1          //  T4_CT = 1;  //¼ÆÊý
  294   1              T4_CT = 0;  //¶¨Ê±
  295   1          //  T4CLKO = 1; //Êä³öÊ±ÖÓ
  296   1              T4CLKO = 0; //²»Êä³öÊ±ÖÓ
  297   1      
  298   1              #if (Timer4_Reload < 65536UL)
  299   1                  T4x12 = 1;    //1T mode
  300   1                  T4H = (u8)((65536UL - Timer4_Reload) / 256);
  301   1                  T4L = (u8)((65536UL - Timer4_Reload) % 256);
  302   1              #else
                           T4x12 = 0;    //12T mode
                           T4H = (u8)((65536UL - Timer4_Reload/12) / 256);
                           T4L = (u8)((65536UL - Timer4_Reload/12) % 256);
                       #endif
  307   1      
  308   1              T4R = 1;    //¿ªÊ¼ÔËÐÐ
  309   1      
  310   1          #else
                       #error "Timer4ÉèÖÃµÄÖÐ¶Ï¹ýÂý!"
                   #endif
  313   1      }
  314          
  315          //========================================================================
  316          // º¯Êý: void timer0_int (void) interrupt TIMER0_VECTOR
  317          // ÃèÊö:  timer0ÖÐ¶Ïº¯Êý.
  318          // ²ÎÊý: none.
  319          // ·µ»Ø: none.
  320          // °æ±¾: V1.0, 2015-1-12
  321          //========================================================================
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 6   

  322          void timer0_int (void) interrupt 1
  323          {
  324   1         P10 = ~P10;
  325   1      }
  326          
  327          //========================================================================
  328          // º¯Êý: void timer1_int (void) interrupt TIMER1_VECTOR
  329          // ÃèÊö:  timer1ÖÐ¶Ïº¯Êý.
  330          // ²ÎÊý: none.
  331          // ·µ»Ø: none.
  332          // °æ±¾: V1.0, 2015-1-12
  333          //========================================================================
  334          void timer1_int (void) interrupt 3
  335          {
  336   1         P11 = ~P11;
  337   1      }
  338          
  339          //========================================================================
  340          // º¯Êý: void timer2_int (void) interrupt TIMER2_VECTOR
  341          // ÃèÊö:  timer2ÖÐ¶Ïº¯Êý.
  342          // ²ÎÊý: none.
  343          // ·µ»Ø: none.
  344          // °æ±¾: V1.0, 2015-1-12
  345          //========================================================================
  346          void timer2_int (void) interrupt 12
  347          {
  348   1          P52 = ~P52;
  349   1      }
  350          
  351          //========================================================================
  352          // º¯Êý: void timer3_int (void) interrupt TIMER3_VECTOR
  353          // ÃèÊö:  timer3ÖÐ¶Ïº¯Êý.
  354          // ²ÎÊý: none.
  355          // ·µ»Ø: none.
  356          // °æ±¾: V1.0, 2015-1-12
  357          //========================================================================
  358          void timer3_int(void) interrupt 19
  359          {
  360   1          P13 = ~P13;
  361   1      }
  362          
  363          //========================================================================
  364          // º¯Êý: void timer4_int (void) interrupt TIMER4_VECTOR
  365          // ÃèÊö:  timer4ÖÐ¶Ïº¯Êý.
  366          // ²ÎÊý: none.
  367          // ·µ»Ø: none.
  368          // °æ±¾: V1.0, 2015-1-12
  369          //========================================================================
  370          void timer4_int(void) interrupt 20
  371          {
  372   1          P14 = ~P14;
  373   1      }
  374          
  375          //========================================================================
  376          // º¯Êý: void delay_ms(u8 ms)
  377          // ÃèÊö: ÑÓÊ±º¯Êý¡£
  378          // ²ÎÊý: ms,ÒªÑÓÊ±µÄmsÊý, ÕâÀïÖ»Ö§³Ö1~255ms. ×Ô¶¯ÊÊÓ¦Ö÷Ê±ÖÓ.
  379          // ·µ»Ø: none.
  380          // °æ±¾: VER1.0
  381          // ÈÕÆÚ: 2022-6-3
  382          // ±¸×¢: 
  383          //========================================================================
  384          void delay_ms(u8 ms)
  385          {
  386   1          u16 i;
  387   1          do{
C251 COMPILER V5.60.0,  timer                                                              09/07/22  13:54:36  PAGE 7   

  388   2              i = MAIN_Fosc / 6000;
  389   2              while(--i);   //6T per loop
  390   2          }while(--ms);
  391   1      }
  392          
  393          //========================================================================
  394          // º¯Êý: void KeyResetScan(void)
  395          // ÃèÊö: P3.2¿Ú°´¼ü³¤°´1Ãë´¥·¢Èí¼þ¸´Î»£¬½øÈëUSBÏÂÔØÄ£Ê½¡£
  396          // ²ÎÊý: none.
  397          // ·µ»Ø: none.
  398          // °æ±¾: VER1.0
  399          // ÈÕÆÚ: 2022-6-11
  400          // ±¸×¢: 
  401          //========================================================================
  402          void KeyResetScan(void)
  403          {
  404   1          if(!P32)
  405   1          {
  406   2              if(!Key_Flag)
  407   2              {
  408   3                  Key_cnt++;
  409   3                  if(Key_cnt >= 1000)         //Á¬Ðø1000msÓÐÐ§°´¼ü¼ì²â
  410   3                  {
  411   4                      Key_Flag = 1;           //ÉèÖÃ°´¼ü×´Ì¬£¬·ÀÖ¹ÖØ¸´´¥·¢
  412   4      
  413   4                      USBCON = 0x00;      //Çå³ýUSBÉèÖÃ
  414   4                      USBCLK = 0x00;
  415   4                      IRC48MCR = 0x00;
  416   4                      
  417   4                      delay_ms(10);
  418   4                      IAP_CONTR = 0x60;   //´¥·¢Èí¼þ¸´Î»£¬´ÓISP¿ªÊ¼Ö´ÐÐ
  419   4                      while (1);
  420   4                  }
  421   3              }
  422   2          }
  423   1          else
  424   1          {
  425   2              Key_cnt = 0;
  426   2              Key_Flag = 0;
  427   2          }
  428   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       395     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        14     ------
  bit size             =         1     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        33     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
